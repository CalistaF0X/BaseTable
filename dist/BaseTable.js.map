{
  "version": 3,
  "sources": ["../Table.js", "../Modal.js", "../RendererRegistry.js", "../BaseTable.js"],
  "sourcesContent": ["/**\r\n * BaseTable\r\n * Table build utilities\r\n *\r\n * @author {string} Calista Verner\r\n * @version 1.4.2\r\n * @license MIT\r\n */\r\n\r\nexport class Table {\r\n\r\n    constructor(baseTable) {\r\n        this.baseTable = baseTable;\r\n    }\r\n\r\n    createRowFromData(row) {\r\n        const tr = document.createElement('tr');\r\n        if (row[this.baseTable.idField] !== undefined) tr.dataset.id = String(row[this.baseTable.idField]);\r\n\r\n        for (const col of this.baseTable.columns) {\r\n            const td = document.createElement('td');\r\n            if (col.className) td.className = col.className;\r\n            if (col.width) td.style.width = col.width;\r\n            if (col.attrs && typeof col.attrs === 'object') {\r\n                Object.entries(col.attrs).forEach(([k, v]) => td.setAttribute(k, v));\r\n            }\r\n\r\n            const val = this.getByPath(row, col.key);\r\n\r\n            if (typeof col.renderer === 'function') {\r\n                try {\r\n                    const out = col.renderer(val, row, {\r\n                        table: this.baseTable,\r\n                        col\r\n                    });\r\n                    if (typeof out === 'string') td.innerHTML = out;\r\n                    else if (out instanceof Node) td.appendChild(out);\r\n                    else td.textContent = out ?? '';\r\n                } catch (e) {\r\n                    this.baseTable.error('col.renderer error', e);\r\n                    td.textContent = String(val ?? '');\r\n                }\r\n                tr.appendChild(td);\r\n                continue;\r\n            }\r\n\r\n            const type = col.type || this._inferTypeFromValue(val);\r\n            const renderer = this.baseTable.typeRenderers.get(type);\r\n            if (typeof renderer !== 'function') {\r\n                td.textContent = String(val ?? '');\r\n                tr.appendChild(td);\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                renderer.call(this.baseTable, td, val, col, row, {\r\n                    escapeHtml: BaseTable.escapeHtml,\r\n                    formatPrice: this.formatPrice?.bind(this.baseTable)\r\n                });\r\n            } catch (e) {\r\n                this.baseTable.error('type renderer error', e);\r\n                td.textContent = String(val ?? '');\r\n            }\r\n\r\n            tr.appendChild(td);\r\n        }\r\n\r\n        if (this.baseTable.actions && this.baseTable.actions.length) {\r\n            const tdActions = document.createElement('td');\r\n            tdActions.className = 'text-end';\r\n            for (const a of this.baseTable.actions) {\r\n                const btn = document.createElement('button');\r\n                btn.type = 'button';\r\n                btn.className = a.className || 'btn btn-sm btn-outline-secondary';\r\n                btn.textContent = a.label;\r\n                if (a.title) btn.title = a.title;\r\n                if (a.action) btn.dataset.action = a.action;\r\n                btn.dataset.id = row[this.baseTable.idField];\r\n                if (a.attrs) Object.entries(a.attrs).forEach(([k, v]) => btn.setAttribute(k, v));\r\n                tdActions.appendChild(btn);\r\n                if (typeof a.after === 'function') {\r\n                    try {\r\n                        a.after(btn, row);\r\n                    } catch (e) {\r\n                        this.baseTable.error('action.after', e);\r\n                    }\r\n                }\r\n            }\r\n            tr.appendChild(tdActions);\r\n        }\r\n\r\n        return tr;\r\n    }\r\n\r\n    getByPath(obj, path) {\r\n        if (!obj || !path) return undefined;\r\n        if (path.indexOf('.') === -1) return obj[path];\r\n        return path.split('.').reduce((cur, p) => (cur && cur[p] !== undefined ? cur[p] : undefined), obj);\r\n    }\r\n\r\n    _inferTypeFromValue(val) {\r\n        if (val == null) return 'text';\r\n        if (typeof val === 'boolean') return 'boolean';\r\n        if (typeof val === 'number') return 'number';\r\n        if (val instanceof Date) return 'date';\r\n        const s = String(val);\r\n        if (/^\\d{4}-\\d{2}-\\d{2}T/.test(s) || /^\\d{4}-\\d{2}-\\d{2}/.test(s) || /^\\d{10,13}$/.test(s)) return 'date';\r\n        if (/\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/i.test(s)) return 'image';\r\n        if (/^https?:\\/\\//i.test(s) || /^mailto:/i.test(s) || /^\\/\\//.test(s)) return 'link';\r\n        return 'text';\r\n    }\r\n\r\n    formatPrice(v) {\r\n        if (v === null || v === undefined || v === '') return '\u2014';\r\n        const n = Number(v);\r\n        if (Number.isNaN(n)) return String(v);\r\n        return n.toLocaleString('ru-RU', {\r\n            minimumFractionDigits: 0,\r\n            maximumFractionDigits: 2\r\n        });\r\n    }\r\n\r\n    _buildFormFromSchema(item = {}) {\r\n        if (typeof this.baseTable.ui.formBuilder === 'function') {\r\n            try {\r\n                return this.baseTable.ui.formBuilder(this.baseTable.formSchema, item, this.baseTable.refs, {\r\n                    placeholderSVG: this.baseTable.placeholderSVG.bind(this.baseTable)\r\n                });\r\n            } catch (e) {\r\n                this.baseTable.error('ui.formBuilder error', e);\r\n            }\r\n        }\r\n\r\n        const form = document.createElement('form');\r\n        form.className = 'bt-dynamic-form pe-form';\r\n\r\n        const grid = document.createElement('div');\r\n        grid.className = 'bt-form-grid';\r\n\r\n        if (!document.getElementById('bt-form-grid-style')) {\r\n            const mediaStyle = document.createElement('style');\r\n            mediaStyle.id = 'bt-form-grid-style';\r\n            mediaStyle.textContent = `.bt-form-grid { display: grid; gap: 12px; grid-template-columns: 1fr 1fr; } @media (max-width: 720px) { .bt-form-grid { grid-template-columns: 1fr; } }`;\r\n            document.head.appendChild(mediaStyle);\r\n        }\r\n\r\n        const fieldMap = {};\r\n        const groups = {};\r\n        (this.baseTable.formSchema || []).forEach(f => {\r\n            const g = f.group || '__default';\r\n            if (!groups[g])\r\n                groups[g] = [];\r\n            groups[g].push(f);\r\n        });\r\n\r\n        const makeFieldCard = (title) => {\r\n            const card = document.createElement('div');\r\n            card.className = 'bt-field-card';\r\n            Object.assign(card.style, {\r\n                padding: '10px',\r\n                borderRadius: '10px',\r\n                background: '#fff',\r\n                border: '1px solid #eef4fb',\r\n                boxShadow: '0 6px 18px rgba(12,20,40,0.02)'\r\n            });\r\n            return card;\r\n        };\r\n\r\n        const makeRow = (field) => {\r\n            const wrap = document.createElement('div');\r\n            wrap.className = 'bt-form-row';\r\n\r\n            if (field.type !== 'hidden') {\r\n                const labelRow = document.createElement('div');\r\n                Object.assign(labelRow.style, {\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    alignItems: 'center'\r\n                });\r\n                const label = document.createElement('label');\r\n                label.className = 'form-label';\r\n                label.textContent = field.label || field.name || '';\r\n                Object.assign(label.style, {\r\n                    fontWeight: 600,\r\n                    fontSize: '0.95rem'\r\n                });\r\n                labelRow.appendChild(label);\r\n                if (field.hint) {\r\n                    const hint = document.createElement('div');\r\n                    hint.className = 'form-hint';\r\n                    hint.textContent = field.hint;\r\n                    Object.assign(hint.style, {\r\n                        fontSize: '0.82rem',\r\n                        color: '#6b7280'\r\n                    });\r\n                    labelRow.appendChild(hint);\r\n                }\r\n                if (field.required) {\r\n                    const star = document.createElement('span');\r\n                    star.style.color = '#ef4444';\r\n                    star.textContent = ' *';\r\n                    label.appendChild(star);\r\n                }\r\n                wrap.appendChild(labelRow);\r\n            }\r\n\r\n            let control;\r\n            const attrs = field.attrs || {};\r\n            switch (field.type) {\r\n                case 'textarea':\r\n                    control = document.createElement('textarea');\r\n                    control.rows = attrs.rows || 4;\r\n                    control.className = attrs.className || 'form-control';\r\n                    if (field.placeholder)\r\n                        control.placeholder = field.placeholder;\r\n                    break;\r\n\r\n                case 'number':\r\n                    control = document.createElement('input');\r\n                    control.type = 'number';\r\n                    control.className = attrs.className || 'form-control';\r\n                    if (field.placeholder)\r\n                        control.placeholder = field.placeholder;\r\n                    if (attrs.min !== undefined)\r\n                        control.min = attrs.min;\r\n                    if (attrs.step !== undefined)\r\n                        control.step = attrs.step;\r\n                    break;\r\n\r\n                case 'price': {\r\n                    // wrapper (bootstrap-like input-group)\r\n                    const wrapper = document.createElement('div');\r\n                    wrapper.className = attrs.wrapperClass || 'input-group';\r\n\r\n                    // currency symbol (from field.currency or options.currency)\r\n                    const currencyCode = (field.currency || this.baseTable.options.currency || 'RUB').toUpperCase();\r\n                    const currencySymbols = {\r\n                        RUB: '\u20BD',\r\n                        RUBLES: '\u20BD',\r\n                        USD: '$',\r\n                        EUR: '\u20AC',\r\n                        GBP: '\u00A3'\r\n                    };\r\n                    const currencySign = field.currencySign || (currencySymbols[currencyCode] || currencyCode);\r\n\r\n                    const prefix = document.createElement('span');\r\n                    prefix.className = attrs.prefixClass || 'input-group-text';\r\n                    prefix.setAttribute('aria-hidden', 'true');\r\n                    prefix.textContent = currencySign;\r\n\r\n                    // visible (formatted) input for user interaction\r\n                    const visible = document.createElement('input');\r\n                    visible.type = 'text';\r\n                    visible.className = (attrs.className ? attrs.className + ' ' : '') + 'form-control bt-field-price-visible';\r\n                    if (field.placeholder)\r\n                        visible.placeholder = field.placeholder;\r\n                    visible.setAttribute('inputmode', 'numeric');\r\n                    visible.setAttribute('autocomplete', 'off');\r\n                    visible.setAttribute('aria-label', field.label || field.name || '\u0426\u0435\u043D\u0430');\r\n\r\n                    // hidden input that will actually carry the numeric value for the form\r\n                    const hidden = document.createElement('input');\r\n                    hidden.type = 'hidden';\r\n                    // name will be set on hidden below via fieldMap assignment (so form submits numeric value)\r\n                    hidden.className = 'bt-field-price-hidden';\r\n\r\n                    // append to wrapper\r\n                    wrapper.appendChild(prefix);\r\n                    wrapper.appendChild(visible);\r\n                    wrapper.appendChild(hidden);\r\n\r\n                    // helper: parse formatted string -> number\r\n                    const parseToNumber = (s) => {\r\n                        if (s === '' || s === null || s === undefined)\r\n                            return null;\r\n                        try {\r\n                            const cleaned = String(s).replace(/\\s+/g, '').replace(/\\u00A0/g, '').replace(',', '.').replace(/[^0-9.\\-]/g, '');\r\n                            const n = Number(cleaned);\r\n                            return Number.isFinite(n) ? n : null;\r\n                        } catch (e) {\r\n                            return null;\r\n                        }\r\n                    };\r\n\r\n                    // sync visible -> hidden (set hidden.value as raw numeric string; set data-raw on visible)\r\n                    const syncToHidden = (valStr) => {\r\n                        const n = parseToNumber(valStr);\r\n                        if (n === null) {\r\n                            hidden.value = '';\r\n                            visible.removeAttribute('data-raw');\r\n                        } else {\r\n                            // keep integer if user wants 0 decimals; allow fraction if provided (field.precision)\r\n                            const precision = Number.isFinite(field.precision) ? Math.max(0, field.precision) : 0;\r\n                            const raw = precision ? (Math.round(n * Math.pow(10, precision)) / Math.pow(10, precision)) : Math.trunc(n);\r\n                            hidden.value = String(raw);\r\n                            visible.setAttribute('data-raw', String(raw));\r\n                        }\r\n                    };\r\n\r\n                    // try to prefer jQuery plugins if available\r\n                    let pluginApplied = false;\r\n                    const initialVal = item[field.name];\r\n\r\n                    try {\r\n                        if (window.jQuery) {\r\n                            const $v = jQuery(visible);\r\n\r\n                            // maskMoney (common for currency)\r\n                            if (typeof jQuery.fn.maskMoney === 'function') {\r\n                                $v.maskMoney({\r\n                                    thousands: ' ',\r\n                                    decimal: ',',\r\n                                    allowZero: true,\r\n                                    precision: field.precision ?? 0\r\n                                });\r\n                                if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                                    const num = Number(String(initialVal).toString().replace(/\\s+/g, '').replace(',', '.')) || 0;\r\n                                    $v.maskMoney('mask', num);\r\n                                    syncToHidden(String(num));\r\n                                } else {\r\n                                    $v.maskMoney('mask');\r\n                                }\r\n                                // update hidden on change/input\r\n                                $v.on('mask.maskMoney input change', () => {\r\n                                    syncToHidden($v.val());\r\n                                });\r\n                                pluginApplied = true;\r\n                            } // jQuery Mask plugin (RobinHerbots jQuery Mask) \u2014 supports reverse option\r\n                            else if (typeof jQuery.fn.mask === 'function') {\r\n                                try {\r\n                                    $v.mask('000 000 000 000 000', {\r\n                                        reverse: true\r\n                                    });\r\n                                } catch (e) {\r\n                                    // fallback mask pattern if plugin expects different signature\r\n                                    $v.mask('999 999 999 999 999', {\r\n                                        reverse: true\r\n                                    });\r\n                                }\r\n                                if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                                    $v.val(String(initialVal)).trigger('input');\r\n                                    syncToHidden($v.val());\r\n                                }\r\n                                $v.on('input change', () => syncToHidden($v.val()));\r\n                                pluginApplied = true;\r\n                            } // maskedInput (older plugin names) \u2014 try common fn name\r\n                            else if (typeof jQuery.fn.maskedInput === 'function' || typeof jQuery.fn.masked === 'function') {\r\n                                // best-effort: apply a numeric mask (not ideal for arbitrary length)\r\n                                try {\r\n                                    if (typeof jQuery.fn.maskedInput === 'function')\r\n                                        jQuery(visible).maskedInput('999999999999');\r\n                                    else\r\n                                        jQuery(visible).masked('999999999999');\r\n                                } catch (e) {}\r\n                                if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                                    $v.val(String(initialVal)).trigger('input');\r\n                                    syncToHidden($v.val());\r\n                                }\r\n                                $v.on('input change', () => syncToHidden($v.val()));\r\n                                pluginApplied = true;\r\n                            }\r\n                        }\r\n                    } catch (e) {\r\n                        // plugin error -> fallback to JS handler below\r\n                        pluginApplied = false;\r\n                    }\r\n\r\n                    // fallback: simple live formatter (thousands by spaces) if plugin not applied\r\n                    const liveHandler = (ev) => {\r\n                        const raw = String(visible.value || '').replace(/\\s+/g, '').replace(/[^\\d,.-]/g, '').replace(',', '.');\r\n                        const num = parseToNumber(raw);\r\n                        if (num === null) {\r\n                            // keep user input but don't break caret too much\r\n                            syncToHidden(visible.value);\r\n                            return;\r\n                        }\r\n                        // format to locale-like thousands with no decimals by default (or keep precision)\r\n                        const precision = Number.isFinite(field.precision) ? Math.max(0, field.precision) : 0;\r\n                        let display;\r\n                        try {\r\n                            if (precision > 0)\r\n                                display = num.toLocaleString('ru-RU', {\r\n                                    minimumFractionDigits: precision,\r\n                                    maximumFractionDigits: precision\r\n                                });\r\n                            else\r\n                                display = Math.trunc(num).toLocaleString('ru-RU');\r\n                        } catch (e) {\r\n                            display = String(Math.trunc(num)).replace(/\\B(?=(\\d{3})+(?!\\d))/g, ' ');\r\n                        }\r\n\r\n                        // try to preserve caret by setting to end (simple)\r\n                        visible.value = display;\r\n                        try {\r\n                            visible.setSelectionRange(visible.value.length, visible.value.length);\r\n                        } catch (_) {}\r\n                        syncToHidden(display);\r\n                    };\r\n\r\n                    if (!pluginApplied) {\r\n                        visible.addEventListener('input', liveHandler);\r\n                        this.baseTable._listeners.push({\r\n                            el: visible,\r\n                            ev: 'input',\r\n                            fn: liveHandler\r\n                        });\r\n                        // format initial\r\n                        try {\r\n                            if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                                const n = parseToNumber(String(initialVal));\r\n                                if (n !== null) {\r\n                                    const precision = Number.isFinite(field.precision) ? Math.max(0, field.precision) : 0;\r\n                                    visible.value = precision > 0 ? n.toLocaleString('ru-RU', {\r\n                                        minimumFractionDigits: precision,\r\n                                        maximumFractionDigits: precision\r\n                                    }) : Math.trunc(n).toLocaleString('ru-RU');\r\n                                    syncToHidden(visible.value);\r\n                                } else {\r\n                                    visible.value = String(initialVal);\r\n                                    syncToHidden(visible.value);\r\n                                }\r\n                            }\r\n                        } catch (e) {}\r\n                    }\r\n\r\n                    // when clicking prefix focus visible input\r\n                    prefix.addEventListener('click', () => {\r\n                        try {\r\n                            visible.focus();\r\n                        } catch (e) {}\r\n                    });\r\n                    this.baseTable._listeners.push({\r\n                        el: prefix,\r\n                        ev: 'click',\r\n                        fn: () => {\r\n                            try {\r\n                                visible.focus();\r\n                            } catch (e) {}\r\n                        }\r\n                    });\r\n\r\n                    // expose visible as the UI control for population, but the hidden carries the name\r\n                    // we must register both in fieldMap: visible for UI updates, hidden for form data\r\n                    fieldMap[field.name] = visible;\r\n                    // later population code will use visible (formatting)\r\n                    // set hidden's name so FormData uses numeric value\r\n                    hidden.name = field.name;\r\n                    // also set ids for both (use distinct ids)\r\n                    visible.id = `bt-field-${field.name}-visible`;\r\n                    hidden.id = `bt-field-${field.name}`;\r\n                    // append wrapper to DOM in place of simple control\r\n                    wrap.appendChild(wrapper);\r\n                    // note: `wrap` is outer row element created earlier in makeRow\r\n                    // return early like select case (so global post-switch name/id/aria setting is not applied to visible)\r\n                    return wrap;\r\n                }\r\n\r\n                case 'select': {\r\n                    const selectWrap = document.createElement('div');\r\n                    Object.assign(selectWrap.style, {\r\n                        display: 'flex',\r\n                        flexDirection: 'column',\r\n                        gap: '6px'\r\n                    });\r\n                    let searchInput = null;\r\n                    if (field.searchable) {\r\n                        searchInput = document.createElement('input');\r\n                        searchInput.type = 'search';\r\n                        searchInput.placeholder = '\u041F\u043E\u0438\u0441\u043A...';\r\n                        searchInput.className = 'form-control form-control-sm';\r\n                        searchInput.style.width = '100%';\r\n                        selectWrap.appendChild(searchInput);\r\n                    }\r\n                    control = document.createElement('select');\r\n                    control.className = attrs.className || 'form-select';\r\n                    control.name = field.name;\r\n                    control.style.width = '100%';\r\n                    control.setAttribute('aria-label', field.label || field.name || '');\r\n                    const placeholderOption = document.createElement('option');\r\n                    placeholderOption.value = '';\r\n                    placeholderOption.textContent = field.placeholder ?? '\u2014';\r\n                    placeholderOption.setAttribute('aria-placeholder', 'true');\r\n                    control.appendChild(placeholderOption);\r\n                    const opts = field.options || (field.ref ? (this.baseTable.refs[field.ref] ?? null) : null);\r\n                    let populatePromise = null;\r\n                    if (opts && opts.length) {\r\n                        for (const o of opts) {\r\n                            const {\r\n                                value,\r\n                                label\r\n                            } = this.baseTable._mapOptionValueLabel(o, field);\r\n                            const optEl = document.createElement('option');\r\n                            optEl.value = value;\r\n                            optEl.textContent = label;\r\n                            optEl.title = label;\r\n                            control.appendChild(optEl);\r\n                        }\r\n                    } else {\r\n                        const tmp = document.createElement('option');\r\n                        tmp.value = '';\r\n                        tmp.disabled = true;\r\n                        tmp.selected = true;\r\n                        tmp.textContent = field.ref ? '\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...' : '\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445';\r\n                        control.appendChild(tmp);\r\n                        if (field.ref) {\r\n                            populatePromise = (async () => {\r\n                                try {\r\n                                    await this.baseTable._ensureRefLoaded(field.ref);\r\n                                } catch (e) {}\r\n                                try {\r\n                                    await this.baseTable._populateSelectFromRef(control, field);\r\n                                } catch (e) {\r\n                                    this.baseTable.error('_populateSelectFromRef async error', e);\r\n                                }\r\n                            })();\r\n                        }\r\n                    }\r\n                    control._populatePromise = populatePromise;\r\n                    if (searchInput) {\r\n                        const onSearch = (e) => {\r\n                            const q = String(e.target.value || '').toLowerCase().trim();\r\n                            Array.from(control.options).forEach(opt => {\r\n                                if (opt.getAttribute('aria-placeholder') === 'true')\r\n                                    return opt.hidden = false;\r\n                                const label = (opt.textContent || '').toLowerCase();\r\n                                opt.hidden = q ? !label.includes(q) : false;\r\n                            });\r\n                            if (control.selectedOptions.length && control.selectedOptions[0].hidden)\r\n                                control.value = '';\r\n                        };\r\n                        searchInput.addEventListener('input', onSearch);\r\n                        this.baseTable._listeners.push({\r\n                            el: searchInput,\r\n                            ev: 'input',\r\n                            fn: onSearch\r\n                        });\r\n                    }\r\n                    selectWrap.appendChild(control);\r\n                    wrap.appendChild(selectWrap);\r\n                    fieldMap[field.name] = control;\r\n                    return wrap;\r\n                }\r\n\r\n                case 'checkbox': {\r\n                    control = document.createElement('input');\r\n                    control.type = 'checkbox';\r\n                    control.className = attrs.className || 'form-check-input';\r\n                    const chkRow = document.createElement('div');\r\n                    Object.assign(chkRow.style, {\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '8px'\r\n                    });\r\n                    chkRow.appendChild(control);\r\n                    if (field.note) {\r\n                        const note = document.createElement('div');\r\n                        note.textContent = field.note;\r\n                        Object.assign(note.style, {\r\n                            fontSize: '0.92rem',\r\n                            color: '#374151'\r\n                        });\r\n                        chkRow.appendChild(note);\r\n                    }\r\n                    wrap.appendChild(chkRow);\r\n                    fieldMap[field.name] = control;\r\n                    return wrap;\r\n                }\r\n\r\n                case 'date':\r\n                    control = document.createElement('input');\r\n                    control.type = 'date';\r\n                    control.className = attrs.className || 'form-control';\r\n                    break;\r\n\r\n                case 'image': {\r\n                    const row = document.createElement('div');\r\n                    Object.assign(row.style, {\r\n                        display: 'grid',\r\n                        gridTemplateColumns: '1fr 180px',\r\n                        gap: '14px',\r\n                        alignItems: 'start'\r\n                    });\r\n\r\n                    // \u0421\u043A\u0440\u044B\u0442\u043E\u0435 \u043F\u043E\u043B\u0435 \u0434\u043B\u044F \u0445\u0440\u0430\u043D\u0435\u043D\u0438\u044F \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u044F (\u0441\u0435\u0440\u0432\u0435\u0440\u043D\u044B\u0439 \u043F\u0443\u0442\u044C \u0438\u043B\u0438 data URL)\r\n                    const control = document.createElement('input');\r\n                    control.type = 'hidden';\r\n                    control.className = attrs.className || 'form-control';\r\n                    control.name = field.name;\r\n\r\n                    // \u041E\u0431\u043B\u0430\u0441\u0442\u044C Drag & Drop / \u043A\u043B\u0438\u043A \u0434\u043B\u044F \u0432\u044B\u0431\u043E\u0440\u0430 \u0444\u0430\u0439\u043B\u0430 (\u0441\u0442\u0438\u043B\u0438\u0437\u043E\u0432\u0430\u043D\u043D\u0430\u044F)\r\n                    const dropArea = document.createElement('div');\r\n                    dropArea.className = 'bt-drop';\r\n                    dropArea.innerHTML = `\r\n    <div class=\"bt-drop-icon\" aria-hidden>\r\n      <svg viewBox=\"0 0 24 24\" fill=\"none\"><path d=\"M12 3v10\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M8 7l4-4 4 4\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><path d=\"M21 15v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>\r\n    </div>\r\n    <div class=\"bt-drop-text\">\u041F\u0435\u0440\u0435\u0442\u0430\u0449\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u0438\u043B\u0438 \u043A\u043B\u0438\u043A\u043D\u0438\u0442\u0435</div>\r\n    <div class=\"bt-drop-sub\">\u041F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u044E\u0442\u0441\u044F JPG, PNG, WEBP. \u041C\u0430\u043A\u0441. \u0440\u0430\u0437\u043C\u0435\u0440: 5 MB</div>\r\n  `;\r\n\r\n                    // \u0421\u043A\u0440\u044B\u0442\u044B\u0439 input[type=file] \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F \u0434\u0438\u0430\u043B\u043E\u0433\u0430\r\n                    const fileInput = document.createElement('input');\r\n                    fileInput.type = 'file';\r\n                    fileInput.accept = 'image/*';\r\n                    fileInput.style.display = 'none';\r\n\r\n                    // \u041F\u0440\u0435\u0432\u044C\u044E \u0438 \u043A\u043D\u043E\u043F\u043A\u0438 \u0441\u043F\u0440\u0430\u0432\u0430\r\n                    const previewWrap = document.createElement('div');\r\n                    previewWrap.className = 'pe-right';\r\n                    const previewContainer = document.createElement('div');\r\n                    previewContainer.style.position = 'relative';\r\n                    const preview = document.createElement('img');\r\n                    preview.className = 'bt-preview';\r\n                    preview.src = (item && item[field.name]) ? item[field.name] : this.baseTable.placeholderSVG(360, 180);\r\n                    preview.alt = 'preview';\r\n\r\n                    // progress UI\r\n                    const progressWrap = document.createElement('div');\r\n                    progressWrap.className = 'bt-progress-wrap';\r\n                    const progressBar = document.createElement('div');\r\n                    progressBar.className = 'bt-progress';\r\n                    const progressFill = document.createElement('div');\r\n                    progressFill.className = 'bt-progress-fill';\r\n                    progressBar.appendChild(progressFill);\r\n                    const progressPercent = document.createElement('div');\r\n                    progressPercent.className = 'bt-progress-percent';\r\n                    progressPercent.textContent = '0%';\r\n                    progressWrap.appendChild(progressBar);\r\n                    progressWrap.appendChild(progressPercent);\r\n\r\n                    // status text + cancel/retry button\r\n                    const status = document.createElement('div');\r\n                    status.className = 'bt-status bt-small';\r\n                    status.textContent = '';\r\n\r\n                    const controls = document.createElement('div');\r\n                    controls.className = 'bt-controls';\r\n                    const resetBtn = document.createElement('button');\r\n                    resetBtn.type = 'button';\r\n                    resetBtn.className = 'bt-btn ghost';\r\n                    resetBtn.textContent = '\u0421\u0431\u0440\u043E\u0441\u0438\u0442\u044C';\r\n                    const openBtn = document.createElement('button');\r\n                    openBtn.type = 'button';\r\n                    openBtn.className = 'bt-btn primary';\r\n                    openBtn.textContent = '\u041E\u0442\u043A\u0440\u044B\u0442\u044C';\r\n                    controls.appendChild(resetBtn);\r\n                    controls.appendChild(openBtn);\r\n\r\n                    // Cancel/Retry button (\u043F\u043E\u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435/\u043E\u0448\u0438\u0431\u043A\u0435)\r\n                    const actionBtn = document.createElement('button');\r\n                    actionBtn.type = 'button';\r\n                    actionBtn.className = 'bt-btn ghost';\r\n                    actionBtn.style.display = 'none';\r\n                    actionBtn.textContent = '\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C';\r\n                    controls.appendChild(actionBtn);\r\n\r\n                    previewContainer.appendChild(preview);\r\n                    previewContainer.appendChild(progressWrap);\r\n                    previewContainer.appendChild(status);\r\n\r\n                    previewWrap.appendChild(previewContainer);\r\n                    previewWrap.appendChild(controls);\r\n\r\n                    // FIELD appended on left column later\r\n                    // \u041D\u0430\u043A\u043B\u0430\u0434\u043A\u0430 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 (\u0432\u0438\u0437\u0443\u0430\u043B\u044C\u043D\u043E \u043D\u0435 \u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u0430 \u2014 \u0438\u0441\u043F\u043E\u043B\u044C\u0437\u0443\u0435\u043C \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0438 \u0441\u0442\u0430\u0442\u0443\u0441)\r\n\r\n                    // \u043F\u0435\u0440\u0435\u043C\u0435\u043D\u043D\u0430\u044F \u0434\u043B\u044F \u0442\u0435\u043A\u0443\u0449\u0435\u0433\u043E XHR (\u0447\u0442\u043E\u0431\u044B \u043C\u043E\u0436\u043D\u043E \u0431\u044B\u043B\u043E \u043E\u0442\u043C\u0435\u043D\u0438\u0442\u044C)\r\n                    let currentXhr = null;\r\n\r\n                    // \u0432\u0441\u043F\u043E\u043C\u043E\u0433\u0430\u0442\u0435\u043B\u044C\u043D\u044B\u0435 \u0444\u0443\u043D\u043A\u0446\u0438\u0438 \u0434\u043B\u044F \u0441\u0442\u0430\u0442\u0443\u0441\u043E\u0432\r\n                    const showStatus = (txt, state) => {\r\n                        status.textContent = txt || '';\r\n                        status.classList.remove('error', 'success');\r\n                        if (state === 'error')\r\n                            status.classList.add('error');\r\n                        if (state === 'success')\r\n                            status.classList.add('success');\r\n                    };\r\n\r\n                    const setProgress = (percent, indeterminate = false) => {\r\n                        if (indeterminate) {\r\n                            // \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C \u0438\u043D\u0434\u0435\u0442-\u043F\u043E\u043B\u043E\u0441\u043A\u0443\r\n                            if (!progressBar.querySelector('.bt-progress-indet')) {\r\n                                const ind = document.createElement('div');\r\n                                ind.className = 'bt-progress-indet';\r\n                                progressBar.appendChild(ind);\r\n                            }\r\n                            progressFill.style.width = '100%';\r\n                            progressPercent.textContent = '...';\r\n                        } else {\r\n                            const p = Math.max(0, Math.min(100, Math.round(percent)));\r\n                            const anim = progressBar.querySelector('.bt-progress-indet');\r\n                            if (anim)\r\n                                anim.remove();\r\n                            progressFill.style.width = `${p}%`;\r\n                            progressPercent.textContent = `${p}%`;\r\n                        }\r\n                    };\r\n\r\n                    const resetUI = () => {\r\n                        setProgress(0);\r\n                        showStatus('', '');\r\n                        actionBtn.style.display = 'none';\r\n                        actionBtn.textContent = '\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C';\r\n                        actionBtn.className = 'bt-btn ghost';\r\n                    };\r\n\r\n                    // \u0410\u0441\u0438\u043D\u0445\u0440\u043E\u043D\u043D\u0430\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438 \u0444\u0430\u0439\u043B\u0430 \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0447\u0435\u0440\u0435\u0437 XHR (\u0441 \u043F\u043E\u0434\u0434\u0435\u0440\u0436\u043A\u043E\u0439 progress + cancel)\r\n                    const uploadFile = (file) => {\r\n                        return new Promise((resolve, reject) => {\r\n                            if (!(file instanceof File))\r\n                                return reject(new Error('uploadFile expects a File'));\r\n\r\n                            // abort \u043F\u0440\u0435\u0434\u044B\u0434\u0443\u0449\u0435\u0433\u043E \u0435\u0441\u043B\u0438 \u0435\u0441\u0442\u044C\r\n                            if (currentXhr) {\r\n                                try {\r\n                                    currentXhr.abort();\r\n                                } catch (e) {\r\n                                    /* ignore */\r\n                                }\r\n                                currentXhr = null;\r\n                            }\r\n\r\n                            const uploadUrl = this.baseTable.options.uploadUrl || '/';\r\n                            const categoryName = (field && field.category) || (item && item.category) || this.baseTable.options.defaultCategory || 'default';\r\n\r\n                            const fd = new FormData();\r\n                            fd.append('file', file);\r\n                            fd.append('category', categoryName);\r\n                            fd.append('admPanel', 'imageUpload');\r\n\r\n                            const xhr = new XMLHttpRequest();\r\n                            currentXhr = xhr;\r\n\r\n                            xhr.open('POST', uploadUrl, true);\r\n                            if (this.baseTable.options.withCredentials)\r\n                                xhr.withCredentials = true;\r\n\r\n                            // \u043A\u0430\u0441\u0442\u043E\u043C\u043D\u044B\u0435 \u0437\u0430\u0433\u043E\u043B\u043E\u0432\u043A\u0438 (\u043D\u0435 \u0434\u043B\u044F Content-Type)\r\n                            if (this.baseTable.options.uploadHeaders && typeof this.baseTable.options.uploadHeaders === 'object') {\r\n                                Object.keys(this.baseTable.options.uploadHeaders).forEach((k) => {\r\n                                    try {\r\n                                        xhr.setRequestHeader(k, this.baseTable.options.uploadHeaders[k]);\r\n                                    } catch (err) {\r\n                                        /* ignore header set errors */\r\n                                    }\r\n                                });\r\n                            }\r\n\r\n                            // \u043F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0435\u043C UI \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438\r\n                            actionBtn.style.display = 'inline-block';\r\n                            actionBtn.textContent = '\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C';\r\n                            actionBtn.className = 'bt-btn ghost';\r\n                            showStatus('\u041D\u0430\u0447\u0430\u043B\u043E \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0438...', '');\r\n                            setProgress(0);\r\n\r\n                            // \u043F\u0440\u0438\u0432\u044F\u0436\u0435\u043C cancel\r\n                            const onCancel = () => {\r\n                                if (xhr) {\r\n                                    try {\r\n                                        xhr.abort();\r\n                                    } catch (e) {}\r\n                                    showStatus('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430', 'error');\r\n                                    resetUI();\r\n                                    reject(new Error('Upload cancelled'));\r\n                                }\r\n                            };\r\n                            actionBtn.onclick = onCancel;\r\n\r\n                            xhr.upload.onprogress = (ev) => {\r\n                                if (ev.lengthComputable) {\r\n                                    setProgress((ev.loaded / ev.total) * 100, false);\r\n                                    showStatus('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430: ' + Math.round((ev.loaded / ev.total) * 100) + '%', '');\r\n                                } else {\r\n                                    // \u0438\u043D\u0434\u0435\u0442\u0435\u0440\u043C\u0438\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u043D\u044B\u0439 \u0440\u0435\u0436\u0438\u043C\r\n                                    setProgress(0, true);\r\n                                    showStatus('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...', '');\r\n                                }\r\n                            };\r\n\r\n                            xhr.onload = () => {\r\n                                currentXhr = null;\r\n                                // \u0441\u0442\u0430\u0442\u0443\u0441 2xx\r\n                                if (xhr.status >= 200 && xhr.status < 300) {\r\n                                    let data = {};\r\n                                    try {\r\n                                        data = JSON.parse(xhr.responseText || '{}');\r\n                                    } catch (e) {\r\n                                        data = {};\r\n                                    }\r\n                                    const serverPath = data.path || data.url || data.filePath || data.filename || data.file || null;\r\n                                    if (!serverPath) {\r\n                                        showStatus('\u0421\u0435\u0440\u0432\u0435\u0440 \u043D\u0435 \u0432\u0435\u0440\u043D\u0443\u043B \u043F\u0443\u0442\u044C \u043A \u0444\u0430\u0439\u043B\u0443', 'error');\r\n                                        resetUI();\r\n                                        return reject(new Error('Server did not return file path'));\r\n                                    }\r\n                                    // \u0443\u0441\u043F\u0435\u0445\r\n                                    setProgress(100);\r\n                                    showStatus('\u0413\u043E\u0442\u043E\u0432\u043E', 'success');\r\n                                    actionBtn.style.display = 'none';\r\n                                    actionBtn.textContent = '\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0435\u0449\u0451';\r\n                                    actionBtn.className = 'bt-btn ghost';\r\n                                    actionBtn.onclick = () => {\r\n                                        resetUI();\r\n                                        fileInput.value = '';\r\n                                    };\r\n                                    control.value = serverPath;\r\n                                    preview.src = serverPath;\r\n                                    control.dispatchEvent(new Event('change', {\r\n                                        bubbles: true\r\n                                    }));\r\n                                    return resolve(serverPath);\r\n                                } else {\r\n                                    let txt = xhr.responseText || `${xhr.status} ${xhr.statusText}`;\r\n                                    try {\r\n                                        txt = JSON.parse(xhr.responseText || '') || txt;\r\n                                    } catch (e) {\r\n                                        /* leave text */\r\n                                    }\r\n                                    showStatus('\u041E\u0448\u0438\u0431\u043A\u0430: ' + (typeof txt === 'string' ? txt : JSON.stringify(txt)), 'error');\r\n                                    actionBtn.style.display = 'inline-block';\r\n                                    actionBtn.textContent = '\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C';\r\n                                    actionBtn.className = 'bt-btn primary';\r\n                                    actionBtn.onclick = () => {\r\n                                        resetUI();\r\n                                        handleFile(file);\r\n                                    };\r\n                                    resetUI();\r\n                                    return reject(new Error('Upload failed: ' + xhr.status));\r\n                                }\r\n                            };\r\n\r\n                            xhr.onerror = () => {\r\n                                currentXhr = null;\r\n                                showStatus('\u0421\u0435\u0442\u0435\u0432\u0430\u044F \u043E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0437\u0430\u0433\u0440\u0443\u0437\u043A\u0435', 'error');\r\n                                actionBtn.style.display = 'inline-block';\r\n                                actionBtn.textContent = '\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C';\r\n                                actionBtn.className = 'bt-btn primary';\r\n                                actionBtn.onclick = () => {\r\n                                    resetUI();\r\n                                    handleFile(file);\r\n                                };\r\n                                resetUI();\r\n                                return reject(new Error('Network error during upload'));\r\n                            };\r\n\r\n                            xhr.onabort = () => {\r\n                                currentXhr = null;\r\n                                showStatus('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430', 'error');\r\n                                actionBtn.style.display = 'inline-block';\r\n                                actionBtn.textContent = '\u041F\u043E\u0432\u0442\u043E\u0440\u0438\u0442\u044C';\r\n                                actionBtn.className = 'bt-btn primary';\r\n                                actionBtn.onclick = () => {\r\n                                    resetUI();\r\n                                    handleFile(file);\r\n                                };\r\n                                resetUI();\r\n                                return reject(new Error('Upload aborted'));\r\n                            };\r\n\r\n                            xhr.send(fd);\r\n                        });\r\n                    };\r\n\r\n                    // \u0412\u0441\u043F\u043E\u043C\u043E\u0433\u0430\u0442\u0435\u043B\u044C\u043D\u0430\u044F \u0444\u0443\u043D\u043A\u0446\u0438\u044F \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u0444\u0430\u0439\u043B\u0430/URL\r\n                    const handleFile = (fileOrUrl) => {\r\n                        if (!fileOrUrl)\r\n                            return;\r\n                        if (fileOrUrl instanceof File) {\r\n                            if (!fileOrUrl.type.startsWith('image/')) {\r\n                                preview.src = this.baseTable.placeholderSVG(360, 180);\r\n                                control.value = '';\r\n                                showStatus('\u041D\u0435\u043F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043C\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430', 'error');\r\n                                return;\r\n                            }\r\n                            // \u0441\u0440\u0430\u0437\u0443 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043C \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\r\n                            uploadFile(fileOrUrl).catch((err) => {\r\n                                console.error('Upload failed', err);\r\n                                // fallback: \u043F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043B\u043E\u043A\u0430\u043B\u044C\u043D\u0443\u044E \u043F\u0440\u0435\u0432\u044C\u044E, \u043D\u043E \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0442\u044C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435\r\n                                const reader = new FileReader();\r\n                                reader.onload = () => {\r\n                                    preview.src = String(reader.result || '');\r\n                                };\r\n                                reader.onerror = () => {\r\n                                    preview.src = this.baseTable.placeholderSVG(360, 180);\r\n                                    control.value = '';\r\n                                };\r\n                                reader.readAsDataURL(fileOrUrl);\r\n\r\n                                // \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435\r\n                                if (this.baseTable.notifications && typeof this.baseTable.notifications.error === 'function') {\r\n                                    this.baseTable.notifications.error('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440.');\r\n                                } else {\r\n                                    showStatus('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435', 'error');\r\n                                }\r\n                            });\r\n                        } else if (typeof fileOrUrl === 'string') {\r\n                            const url = fileOrUrl.trim();\r\n                            if (!url)\r\n                                return;\r\n                            const tmp = new Image();\r\n                            tmp.onload = () => {\r\n                                // \u0414\u043B\u044F URL \u043C\u044B \u043D\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u043C \u0435\u0433\u043E \u043D\u0430 \u0441\u0435\u0440\u0432\u0435\u0440 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u2014 \u043E\u0441\u0442\u0430\u0432\u043B\u044F\u0435\u043C \u043A\u0430\u043A \u0435\u0441\u0442\u044C.\r\n                                control.value = url;\r\n                                preview.src = url;\r\n                                control.dispatchEvent(new Event('change', {\r\n                                    bubbles: true\r\n                                }));\r\n                                showStatus('URL \u0443\u0441\u0442\u0430\u043D\u043E\u0432\u043B\u0435\u043D', '');\r\n                            };\r\n                            tmp.onerror = () => {\r\n                                preview.src = this.baseTable.placeholderSVG(360, 180);\r\n                                control.value = '';\r\n                                showStatus('\u041D\u0435\u0432\u0430\u043B\u0438\u0434\u043D\u044B\u0439 URL \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F', 'error');\r\n                            };\r\n                            tmp.src = url;\r\n                        }\r\n                    };\r\n\r\n                    // \u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0447\u0438\u043A\u0438 \u0441\u043E\u0431\u044B\u0442\u0438\u0439\r\n                    const onClickDrop = (e) => {\r\n                        e.preventDefault();\r\n                        fileInput.click();\r\n                    };\r\n                    const onFileChange = (e) => {\r\n                        const f = e.target.files && e.target.files[0];\r\n                        if (f)\r\n                            handleFile(f);\r\n                    };\r\n                    const onDragOver = (e) => {\r\n                        e.preventDefault();\r\n                        dropArea.classList.add('dragging');\r\n                    };\r\n                    const onDragLeave = (e) => {\r\n                        e.preventDefault();\r\n                        dropArea.classList.remove('dragging');\r\n                    };\r\n                    const onDrop = (e) => {\r\n                        e.preventDefault();\r\n                        dropArea.classList.remove('dragging');\r\n                        const f = (e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0]);\r\n                        if (f) {\r\n                            handleFile(f);\r\n                            return;\r\n                        }\r\n                        const text = (e.dataTransfer && e.dataTransfer.getData && e.dataTransfer.getData('text')) || '';\r\n                        if (text && text.startsWith('http'))\r\n                            handleFile(text);\r\n                    };\r\n                    const onPaste = (e) => {\r\n                        const items = (e.clipboardData && e.clipboardData.items) || [];\r\n                        for (let i = 0; i < items.length; i++) {\r\n                            const it = items[i];\r\n                            if (it.kind === 'file') {\r\n                                const f = it.getAsFile();\r\n                                if (f) {\r\n                                    handleFile(f);\r\n                                    return;\r\n                                }\r\n                            }\r\n                        }\r\n                        const text = (e.clipboardData || window.clipboardData).getData('text');\r\n                        if (text && text.startsWith('http'))\r\n                            handleFile(text);\r\n                    };\r\n\r\n                    // reset/open \u043A\u043D\u043E\u043F\u043A\u0438\r\n                    const onReset = (e) => {\r\n                        e.preventDefault();\r\n                        control.value = '';\r\n                        fileInput.value = '';\r\n                        preview.src = this.baseTable.placeholderSVG(360, 180);\r\n                        control.dispatchEvent(new Event('change', {\r\n                            bubbles: true\r\n                        }));\r\n                        resetUI();\r\n                    };\r\n                    const onOpen = (e) => {\r\n                        e.preventDefault();\r\n                        const val = String(control.value || '').trim();\r\n                        if (!val)\r\n                            return;\r\n                        if (val.startsWith('data:') || val.startsWith('http')) {\r\n                            window.open(val, '_blank');\r\n                        } else {\r\n                            console.warn('\u041D\u0435\u0447\u0435\u0433\u043E \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0442\u044C: \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0441\u0441\u044B\u043B\u043A\u043E\u0439 \u0438\u043B\u0438 data URL.');\r\n                            showStatus('\u0417\u043D\u0430\u0447\u0435\u043D\u0438\u0435 \u043D\u0435 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0441\u0441\u044B\u043B\u043A\u043E\u0439', 'error');\r\n                        }\r\n                    };\r\n\r\n                    // \u041D\u0430\u0432\u0435\u0448\u0438\u0432\u0430\u0435\u043C \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u0438 \u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u044F\u0435\u043C \u0432 this.baseTable._listeners\r\n                    dropArea.addEventListener('click', onClickDrop);\r\n                    this.baseTable._listeners.push({\r\n                        el: dropArea,\r\n                        ev: 'click',\r\n                        fn: onClickDrop\r\n                    });\r\n\r\n                    fileInput.addEventListener('change', onFileChange);\r\n                    this.baseTable._listeners.push({\r\n                        el: fileInput,\r\n                        ev: 'change',\r\n                        fn: onFileChange\r\n                    });\r\n\r\n                    dropArea.addEventListener('dragover', onDragOver);\r\n                    this.baseTable._listeners.push({\r\n                        el: dropArea,\r\n                        ev: 'dragover',\r\n                        fn: onDragOver\r\n                    });\r\n                    dropArea.addEventListener('dragleave', onDragLeave);\r\n                    this.baseTable._listeners.push({\r\n                        el: dropArea,\r\n                        ev: 'dragleave',\r\n                        fn: onDragLeave\r\n                    });\r\n                    dropArea.addEventListener('drop', onDrop);\r\n                    this.baseTable._listeners.push({\r\n                        el: dropArea,\r\n                        ev: 'drop',\r\n                        fn: onDrop\r\n                    });\r\n\r\n                    dropArea.addEventListener('paste', onPaste);\r\n                    this.baseTable._listeners.push({\r\n                        el: dropArea,\r\n                        ev: 'paste',\r\n                        fn: onPaste\r\n                    });\r\n\r\n                    resetBtn.addEventListener('click', onReset);\r\n                    this.baseTable._listeners.push({\r\n                        el: resetBtn,\r\n                        ev: 'click',\r\n                        fn: onReset\r\n                    });\r\n\r\n                    openBtn.addEventListener('click', onOpen);\r\n                    this.baseTable._listeners.push({\r\n                        el: openBtn,\r\n                        ev: 'click',\r\n                        fn: onOpen\r\n                    });\r\n\r\n                    // \u0441\u043E\u0431\u0435\u0440\u0451\u043C \u0432\u0441\u0451 \u0432\u043E \u0444\u0440\u0430\u0433\u043C\u0435\u043D\u0442\r\n                    const leftCol = document.createElement('div');\r\n                    leftCol.appendChild(dropArea);\r\n                    leftCol.appendChild(fileInput);\r\n                    leftCol.appendChild(control);\r\n\r\n                    row.appendChild(leftCol);\r\n                    row.appendChild(previewWrap);\r\n                    wrap.appendChild(row);\r\n\r\n                    fieldMap[field.name] = control;\r\n                    return wrap;\r\n                }\r\n\r\n                case 'hidden':\r\n                    control = document.createElement('input');\r\n                    control.type = 'hidden';\r\n                    break;\r\n\r\n                case 'json': {\r\n                    // editable JSON key:value editor (list + add/remove) + hidden field for submission\r\n                    const rowWrap = document.createElement('div');\r\n                    rowWrap.className = attrs.className || 'bt-json-wrap';\r\n                    Object.assign(rowWrap.style, {\r\n                        marginTop: '6px'\r\n                    });\r\n\r\n                    // container for list of pairs\r\n                    const list = document.createElement('ul');\r\n                    list.className = 'bt-json-list';\r\n                    Object.assign(list.style, {\r\n                        margin: '6px 0 0 0',\r\n                        paddingLeft: '18px'\r\n                    });\r\n\r\n                    // hidden textarea (so form submits the JSON string) - we'll also parse it on submit to get an object\r\n                    const hidden = document.createElement('textarea');\r\n                    hidden.name = field.name;\r\n                    hidden.style.display = 'none';\r\n\r\n                    // helper: parse incoming data (string or object) into plain object\r\n                    let initialObj = {};\r\n                    const raw = (item && item[field.name] !== undefined) ? item[field.name] : (field.value ?? {});\r\n                    try {\r\n                        initialObj = (typeof raw === 'string') ? JSON.parse(raw) : (raw && typeof raw === 'object' ? raw : {});\r\n                    } catch (e) {\r\n                        initialObj = {};\r\n                    }\r\n\r\n                    // create controls area (Add button)\r\n                    const controls = document.createElement('div');\r\n                    controls.className = 'bt-json-controls';\r\n                    Object.assign(controls.style, {\r\n                        marginTop: '8px',\r\n                        display: 'flex',\r\n                        gap: '8px'\r\n                    });\r\n\r\n                    const addBtn = document.createElement('button');\r\n                    addBtn.type = 'button';\r\n                    addBtn.className = 'btn btn-sm btn-outline-secondary';\r\n                    addBtn.textContent = field.addLabel || '\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C \u043F\u0430\u0440\u0443';\r\n\r\n                    controls.appendChild(addBtn);\r\n\r\n                    // internal helper to sync hidden value from current list\r\n                    const updateHidden = () => {\r\n                        const obj = {};\r\n                        Array.from(list.children).forEach(li => {\r\n                            const kInput = li.querySelector('.bt-json-key');\r\n                            const vInput = li.querySelector('.bt-json-value');\r\n                            if (!kInput)\r\n                                return;\r\n                            const key = String(kInput.value || '').trim();\r\n                            if (!key)\r\n                                return;\r\n                            // skip empty keys\r\n                            // store value as string - leave type parsing for submitHandler if needed\r\n                            obj[key] = (vInput ? vInput.value : '');\r\n                        });\r\n                        try {\r\n                            hidden.value = JSON.stringify(obj);\r\n                        } catch (e) {\r\n                            hidden.value = '{}';\r\n                        }\r\n                    };\r\n\r\n                    // create a row (li) with key/value inputs and remove button\r\n                    const makeRow = (key = '', value = '') => {\r\n                        const li = document.createElement('li');\r\n                        Object.assign(li.style, {\r\n                            marginBottom: '6px',\r\n                            display: 'flex',\r\n                            gap: '8px',\r\n                            alignItems: 'center'\r\n                        });\r\n\r\n                        const keyInput = document.createElement('input');\r\n                        keyInput.type = 'text';\r\n                        keyInput.placeholder = '\u043A\u043B\u044E\u0447';\r\n                        keyInput.className = 'bt-json-key form-control form-control-sm';\r\n                        keyInput.value = key;\r\n\r\n                        const valInput = document.createElement('input');\r\n                        valInput.type = 'text';\r\n                        valInput.placeholder = '\u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435';\r\n                        valInput.className = 'bt-json-value form-control form-control-sm';\r\n                        valInput.value = (value === null || value === undefined) ? '' : String(value);\r\n\r\n                        const removeBtn = document.createElement('button');\r\n                        removeBtn.type = 'button';\r\n                        removeBtn.className = 'btn btn-sm btn-outline-danger';\r\n                        removeBtn.textContent = '\u2715';\r\n                        removeBtn.title = '\u0423\u0434\u0430\u043B\u0438\u0442\u044C';\r\n\r\n                        // append inputs\r\n                        // make key narrower\r\n                        Object.assign(keyInput.style, {\r\n                            width: '30%'\r\n                        });\r\n                        Object.assign(valInput.style, {\r\n                            width: 'calc(70% - 34px)'\r\n                        });\r\n                        // leave space for remove button\r\n                        Object.assign(removeBtn.style, {\r\n                            flex: '0 0 34px',\r\n                            height: '30px',\r\n                            padding: '0 6px'\r\n                        });\r\n\r\n                        li.appendChild(keyInput);\r\n                        li.appendChild(valInput);\r\n                        li.appendChild(removeBtn);\r\n\r\n                        // wire events: update hidden on input\r\n                        const onInput = () => updateHidden();\r\n                        keyInput.addEventListener('input', onInput);\r\n                        valInput.addEventListener('input', onInput);\r\n                        this.baseTable._listeners.push({\r\n                            el: keyInput,\r\n                            ev: 'input',\r\n                            fn: onInput\r\n                        });\r\n                        this.baseTable._listeners.push({\r\n                            el: valInput,\r\n                            ev: 'input',\r\n                            fn: onInput\r\n                        });\r\n\r\n                        const onRemove = (ev) => {\r\n                            ev.preventDefault();\r\n                            // remove li and update hidden\r\n                            try {\r\n                                li.remove();\r\n                            } catch (e) {\r\n                                li.parentNode && li.parentNode.removeChild(li);\r\n                            }\r\n                            updateHidden();\r\n                        };\r\n                        removeBtn.addEventListener('click', onRemove);\r\n                        this.baseTable._listeners.push({\r\n                            el: removeBtn,\r\n                            ev: 'click',\r\n                            fn: onRemove\r\n                        });\r\n\r\n                        return li;\r\n                    };\r\n\r\n                    // populate initial rows\r\n                    if (initialObj && typeof initialObj === 'object') {\r\n                        if (Array.isArray(initialObj)) {\r\n                            initialObj.forEach((v, i) => list.appendChild(makeRow(String(i), (typeof v === 'object') ? JSON.stringify(v) : String(v))));\r\n                        } else {\r\n                            Object.entries(initialObj).forEach(([k, v]) => list.appendChild(makeRow(k, (typeof v === 'object') ? JSON.stringify(v) : String(v))));\r\n                        }\r\n                    }\r\n\r\n                    // initial sync\r\n                    updateHidden();\r\n\r\n                    // add button behavior\r\n                    const onAdd = (ev) => {\r\n                        ev.preventDefault();\r\n                        const newLi = makeRow('', '');\r\n                        list.appendChild(newLi);\r\n                        // focus to key input of the new row\r\n                        const keyInp = newLi.querySelector('.bt-json-key');\r\n                        if (keyInp)\r\n                            setTimeout(() => {\r\n                                try {\r\n                                    keyInp.focus();\r\n                                } catch (e) {}\r\n                            }, 10);\r\n                        updateHidden();\r\n                    };\r\n                    addBtn.addEventListener('click', onAdd);\r\n                    this.baseTable._listeners.push({\r\n                        el: addBtn,\r\n                        ev: 'click',\r\n                        fn: onAdd\r\n                    });\r\n\r\n                    // assemble\r\n                    rowWrap.appendChild(list);\r\n                    rowWrap.appendChild(controls);\r\n                    rowWrap.appendChild(hidden);\r\n\r\n                    wrap.appendChild(rowWrap);\r\n\r\n                    // expose the hidden field to fieldMap so _buildFormFromSchema can set its value if needed\r\n                    fieldMap[field.name] = hidden;\r\n                    return wrap;\r\n                }\r\n\r\n                case 'link':\r\n                case 'text':\r\n                default:\r\n                    control = document.createElement('input');\r\n                    control.type = 'text';\r\n                    control.className = attrs.className || 'form-control';\r\n                    if (field.placeholder)\r\n                        control.placeholder = field.placeholder;\r\n                    break;\r\n            }\r\n\r\n            if (!control)\r\n                control = document.createElement('input');\r\n\r\n            control.name = field.name;\r\n            control.id = `bt-field-${field.name}`;\r\n            control.setAttribute('aria-label', field.label || field.name || '');\r\n            if (field.required)\r\n                control.required = true;\r\n            if (field.readonly)\r\n                control.readOnly = true;\r\n            if (field.disabled)\r\n                control.disabled = true;\r\n\r\n            if (field.note) {\r\n                const note = document.createElement('div');\r\n                note.className = 'pe-note';\r\n                note.textContent = field.note;\r\n                Object.assign(note.style, {\r\n                    fontSize: '0.86rem',\r\n                    color: '#6b7280'\r\n                });\r\n                wrap.appendChild(control);\r\n                wrap.appendChild(note);\r\n            } else\r\n                wrap.appendChild(control);\r\n\r\n            const errorHint = document.createElement('div');\r\n            errorHint.className = 'bt-field-error';\r\n            Object.assign(errorHint.style, {\r\n                color: '#ef4444',\r\n                fontSize: '0.82rem',\r\n                display: 'none'\r\n            });\r\n            wrap.appendChild(errorHint);\r\n\r\n            const onInvalid = (e) => {\r\n                e.preventDefault();\r\n                errorHint.textContent = field.errorMessage || '\u0417\u0430\u043F\u043E\u043B\u043D\u0438\u0442\u0435 \u043A\u043E\u0440\u0440\u0435\u043A\u0442\u043D\u043E';\r\n                errorHint.style.display = 'block';\r\n            };\r\n            control.addEventListener('invalid', onInvalid);\r\n            this.baseTable._listeners.push({\r\n                el: control,\r\n                ev: 'invalid',\r\n                fn: onInvalid\r\n            });\r\n\r\n            const onInputHide = () => {\r\n                errorHint.style.display = 'none';\r\n            };\r\n            control.addEventListener('input', onInputHide);\r\n            this.baseTable._listeners.push({\r\n                el: control,\r\n                ev: 'input',\r\n                fn: onInputHide\r\n            });\r\n\r\n            fieldMap[field.name] = control;\r\n            return wrap;\r\n        };\r\n\r\n        const groupNames = Object.keys(groups);\r\n        for (const gName of groupNames) {\r\n            const fields = groups[gName];\r\n            const isDefault = (gName === '__default');\r\n            if (!isDefault) {\r\n                const card = makeFieldCard(gName);\r\n                card.style.gridColumn = '1 / -1';\r\n                const title = document.createElement('div');\r\n                Object.assign(title.style, {\r\n                    fontWeight: 700,\r\n                    marginBottom: '8px'\r\n                });\r\n                title.textContent = gName;\r\n                card.appendChild(title);\r\n                const inner = document.createElement('div');\r\n                Object.assign(inner.style, {\r\n                    display: 'grid',\r\n                    gridTemplateColumns: '1fr 1fr',\r\n                    gap: '12px'\r\n                });\r\n                for (const f of fields) {\r\n                    const node = makeRow(f);\r\n                    inner.appendChild(node);\r\n                }\r\n                card.appendChild(inner);\r\n                grid.appendChild(card);\r\n            } else {\r\n                for (const f of fields) {\r\n                    const node = makeRow(f);\r\n                    if (f.layout === 'full')\r\n                        node.style.gridColumn = '1 / -1';\r\n                    grid.appendChild(node);\r\n                }\r\n            }\r\n        }\r\n\r\n        const actionsWrap = document.createElement('div');\r\n        Object.assign(actionsWrap.style, {\r\n            gridColumn: '1 / -1',\r\n            display: 'flex',\r\n            justifyContent: 'flex-end',\r\n            gap: '10px',\r\n            paddingTop: '6px'\r\n        });\r\n\r\n        const submit = document.createElement('button');\r\n        submit.type = 'submit';\r\n        submit.className = 'btn btn-primary';\r\n        submit.textContent = '\u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C';\r\n\r\n        const cancel = document.createElement('button');\r\n        cancel.type = 'button';\r\n        cancel.className = 'btn btn-outline-secondary';\r\n        cancel.textContent = '\u041E\u0442\u043C\u0435\u043D\u0438\u0442\u044C';\r\n        cancel.dataset.action = 'cancel';\r\n\r\n        actionsWrap.appendChild(submit);\r\n        actionsWrap.appendChild(cancel);\r\n\r\n        form.appendChild(grid);\r\n        grid.appendChild(actionsWrap);\r\n\r\n        for (const f of this.baseTable.formSchema) {\r\n            const el = fieldMap[f.name];\r\n            if (!el)\r\n                continue;\r\n            const val = item[f.name];\r\n\r\n            switch (f.type) {\r\n                case 'checkbox':\r\n                    el.checked = Boolean(val);\r\n                    break;\r\n\r\n                case 'date':\r\n                    if (val)\r\n                        el.value = val;\r\n                    break;\r\n\r\n                case 'select':\r\n                    if (val !== undefined && val !== null && String(val) !== '') {\r\n                        try {\r\n                            el.value = String(val);\r\n                        } catch (e) {}\r\n                        const hasOption = Array.from(el.options).some(o => o.value === String(val));\r\n                        if (!hasOption && f.ref) {\r\n                            (async () => {\r\n                                try {\r\n                                    if (el._populatePromise)\r\n                                        await el._populatePromise;\r\n                                    else\r\n                                        await this.baseTable._ensureRefLoaded(f.ref).catch(() => {});\r\n                                    await this.baseTable._populateSelectFromRef(el, f);\r\n                                } catch (e) {\r\n                                    this.baseTable.error('async select populate/set error', e);\r\n                                }\r\n                                try {\r\n                                    el.value = String(val);\r\n                                } catch (e) {}\r\n                                if (!Array.from(el.options).some(o => o.value === String(val))) {\r\n                                    setTimeout(() => {\r\n                                        try {\r\n                                            el.value = String(val);\r\n                                        } catch (e) {}\r\n                                    }, 60);\r\n                                }\r\n                            })();\r\n                        }\r\n                    }\r\n                    break;\r\n\r\n                case 'image':\r\n                    // el \u0437\u0434\u0435\u0441\u044C \u2014 hidden input \u043A\u043E\u0442\u043E\u0440\u044B\u0439 \u0445\u0440\u0430\u043D\u0438\u0442 data: \u0438\u043B\u0438 \u043F\u0443\u0442\u044C/URL\r\n                    try {\r\n                        // \u043D\u0430\u0445\u043E\u0434\u0438\u043C DOM-\u044D\u043B\u0435\u043C\u0435\u043D\u0442\u044B \u0440\u044F\u0434\u043E\u043C: row, file input, preview img\r\n                        const ctrlEl = (el.id && form.querySelector(`#${el.id}`)) ? form.querySelector(`#${el.id}`) : el;\r\n                        const rowEl = ctrlEl ? (ctrlEl.closest?.('.bt-form-row') || ctrlEl.parentNode) : null;\r\n                        const fileInput = rowEl ? rowEl.querySelector('input[type=\"file\"]') : null;\r\n                        const preview = rowEl ? rowEl.querySelector('img.bt-image-preview') : null;\r\n\r\n                        // \u043F\u043E\u0434\u0441\u0442\u0430\u0432\u043B\u044F\u0435\u043C \u0437\u043D\u0430\u0447\u0435\u043D\u0438\u0435 (\u043C\u043E\u0436\u0435\u0442 \u0431\u044B\u0442\u044C data: \u0438\u043B\u0438 URL)\r\n                        if (val) {\r\n                            try {\r\n                                el.value = String(val);\r\n                            } catch (e) {\r\n                                el.value = '';\r\n                            }\r\n                            if (preview)\r\n                                preview.src = String(val);\r\n                        } else {\r\n                            el.value = '';\r\n                            if (preview)\r\n                                preview.src = this.baseTable.placeholderSVG(320, 180);\r\n                        }\r\n\r\n                        // \u0435\u0441\u043B\u0438 \u0435\u0441\u0442\u044C file input \u2014 \u043D\u0430\u0432\u0435\u0441\u0438\u043C handler \u0434\u043B\u044F \u0447\u0442\u0435\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u0430 \u0432 dataURL \u0438 \u043F\u043E\u0434\u0441\u0442\u0430\u043D\u043E\u0432\u043A\u0438 \u0432 hidden + preview\r\n                        if (fileInput) {\r\n                            const onFileChange = (e) => {\r\n                                const f = e.target.files && e.target.files[0];\r\n                                if (!f)\r\n                                    return;\r\n                                if (!f.type || !f.type.startsWith('image/')) {\r\n                                    // not an image \u2014 ignore\r\n                                    return;\r\n                                }\r\n                                const reader = new FileReader();\r\n                                reader.onload = () => {\r\n                                    try {\r\n                                        el.value = String(reader.result || '');\r\n                                    } catch (err) {\r\n                                        el.value = '';\r\n                                    }\r\n                                    if (preview)\r\n                                        preview.src = el.value || this.baseTable.placeholderSVG(320, 180);\r\n                                };\r\n                                reader.onerror = () => {\r\n                                    if (preview)\r\n                                        preview.src = this.baseTable.placeholderSVG(320, 180);\r\n                                };\r\n                                reader.readAsDataURL(f);\r\n                            };\r\n\r\n                            // \u0437\u0430\u0449\u0438\u0442\u0430 \u043E\u0442 \u0434\u0432\u043E\u0439\u043D\u043E\u0439 \u043D\u0430\u0432\u0435\u0441\u043A\u0438 \u2014 \u0435\u0441\u043B\u0438 \u0443\u0436\u0435 \u0435\u0441\u0442\u044C \u0442\u0430\u043A\u043E\u0439 \u0441\u043B\u0443\u0448\u0430\u0442\u0435\u043B\u044C, \u043D\u0435 \u0434\u043E\u0431\u0430\u0432\u043B\u044F\u0435\u043C\r\n                            const existing = (this.baseTable._listeners || []).some(l => l.el === fileInput && l.ev === 'change');\r\n                            if (!existing) {\r\n                                fileInput.addEventListener('change', onFileChange);\r\n                                this.baseTable._listeners.push({\r\n                                    el: fileInput,\r\n                                    ev: 'change',\r\n                                    fn: onFileChange\r\n                                });\r\n                            }\r\n                        }\r\n                    } catch (err) {\r\n                        this.baseTable.error('image init error', err);\r\n                    }\r\n                    break;\r\n\r\n                case 'price':\r\n                    if (val !== undefined && val !== null && String(val) !== '') {\r\n                        try {\r\n                            el.value = String(val);\r\n                        } catch (e) {}\r\n                    }\r\n                    try {\r\n                        this.baseTable._applyPriceMaskToElement(el, val);\r\n                    } catch (e) {\r\n                        this.baseTable.error('_applyPriceMaskToElement error', e);\r\n                    }\r\n                    break;\r\n\r\n                default:\r\n                    if (val !== undefined && val !== null) {\r\n                        try {\r\n                            el.value = String(val);\r\n                        } catch (e) {}\r\n                    }\r\n            }\r\n\r\n            // If field is price but was not covered in switch (safety), ensure mask applied:\r\n            if (f.type !== 'price' && el && el.matches && el.matches('input.bt-field-price')) {\r\n                try {\r\n                    this.baseTable._applyPriceMaskToElement(el, el.value || null);\r\n                } catch (e) {}\r\n            }\r\n        }\r\n\r\n        return {\r\n            form,\r\n            fieldMap,\r\n            submitBtn: submit,\r\n            cancelBtn: cancel\r\n        };\r\n    }\r\n}", "/**\r\n * BaseTable\r\n * Modall App Utilities\r\n *\r\n * @author {string} Calista Verner\r\n * @version 1.4.2\r\n * @license MIT\r\n */\r\n\r\nexport class Modal {\r\n    constructor(baseTable) {\r\n        this.baseTable = baseTable;\r\n    }\r\n\r\n    _openFormForItem(initial = {}) {\r\n        if (this.baseTable._modal)\r\n            this._closeModal();\r\n        const modalBuilder = this.baseTable._ensureModalBuilder();\r\n        const title = initial && initial[this.baseTable.idField] ? '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C' : '\u041D\u043E\u0432\u044B\u0439 \u044D\u043B\u0435\u043C\u0435\u043D\u0442';\r\n        const built = this.baseTable.table._buildFormFromSchema(initial || {});\r\n        const containerNode = built.form instanceof Node ? built.form : built;\r\n        const m = modalBuilder.open(title, containerNode instanceof Node ? containerNode : containerNode.form || containerNode);\r\n\r\n        const dialog = m.dialog;\r\n        const form = (containerNode.form || containerNode);\r\n\r\n        const focusableSelector = 'a[href], button, textarea, input, select, [tabindex]:not([tabindex=\"-1\"])';\r\n        const focusables = dialog.querySelectorAll(focusableSelector);\r\n        const firstFocusable = focusables[0],\r\n            lastFocusable = focusables[focusables.length - 1];\r\n        const trap = (e) => {\r\n            if (e.key === 'Tab') {\r\n                if (e.shiftKey) {\r\n                    if (document.activeElement === firstFocusable) {\r\n                        e.preventDefault();\r\n                        lastFocusable.focus();\r\n                    }\r\n                } else if (document.activeElement === lastFocusable) {\r\n                    e.preventDefault();\r\n                    firstFocusable.focus();\r\n                }\r\n            } else if (e.key === 'Escape') {\r\n                e.preventDefault();\r\n                cancelHandler();\r\n            }\r\n        };\r\n        dialog.addEventListener('keydown', trap);\r\n        this.baseTable._listeners.push({\r\n            el: dialog,\r\n            ev: 'keydown',\r\n            fn: trap\r\n        });\r\n\r\n        const self = this.baseTable;\r\n        let resolvedOnce = false;\r\n        const promise = new Promise((resolve) => {\r\n            const submitHandler = async (ev) => {\r\n                ev.preventDefault();\r\n                if (self._isSaving)\r\n                    return;\r\n                if (!form.checkValidity()) {\r\n                    form.reportValidity();\r\n                    return;\r\n                }\r\n\r\n                const fd = new FormData(form);\r\n                const payload = {};\r\n                for (const [k, v] of fd.entries()) {\r\n                    const schemaField = (this.baseTable.formSchema || []).find(x => x.name === k);\r\n                    if (schemaField) {\r\n                        switch (schemaField.type) {\r\n                            case 'number':\r\n                                payload[k] = v === '' ? null : Number(v);\r\n                                break;\r\n                            case 'checkbox':\r\n                                payload[k] = form.querySelector(`[name=\"${k}\"]`).checked;\r\n                                break;\r\n                            default:\r\n                                payload[k] = v;\r\n                        }\r\n                    } else\r\n                        payload[k] = v;\r\n                }\r\n\r\n                (this.baseTable.formSchema || []).filter(f => f.type === 'checkbox').forEach(f => {\r\n                    if (!(f.name in payload))\r\n                        payload[f.name] = !!(form.querySelector(`[name=\"${f.name}\"]`)?.checked);\r\n                });\r\n\r\n                if (initial && initial[this.baseTable.idField] !== undefined && !payload[this.baseTable.idField])\r\n                    payload[this.baseTable.idField] = initial[this.baseTable.idField];\r\n\r\n                self._isSaving = true;\r\n                try {\r\n                    let res;\r\n                    if (!payload[this.baseTable.idField]) {\r\n                        if (!self.apis.apiAdd)\r\n                            throw new Error('apiAdd not provided');\r\n                        res = await self.apis.apiAdd(payload);\r\n                    } else {\r\n                        if (!self.apis.apiUpdate)\r\n                            throw new Error('apiUpdate not provided');\r\n                        res = await self.apis.apiUpdate(payload[this.baseTable.idField], payload);\r\n                    }\r\n                    const saved = self._resolveResponse(res) || payload;\r\n\r\n                    if (!payload[this.baseTable.idField]) {\r\n                        const added = (saved && saved[self.idField] !== undefined) ? saved : Object.assign({\r\n                            [self.idField]: (Date.now())\r\n                        }, saved);\r\n                        self.data.unshift(added);\r\n                    } else {\r\n                        const idx = self.data.findIndex(d => String(d[self.idField]) === String(payload[this.baseTable.idField]));\r\n                        if (idx === -1)\r\n                            self.data.unshift(saved);\r\n                        else\r\n                            self.data[idx] = self._mergeLocalItem(self.data[idx], saved);\r\n                    }\r\n\r\n                    self.log('Saved item', saved);\r\n                    resolvedOnce = true;\r\n                    resolve(saved);\r\n                } catch (err) {\r\n                    self.error('modal save error', err);\r\n                    alert('\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438. \u0421\u043C\u043E\u0442\u0440\u0438\u0442\u0435 \u043A\u043E\u043D\u0441\u043E\u043B\u044C.');\r\n                    resolve(null);\r\n                } finally {\r\n                    self._isSaving = false;\r\n                }\r\n            };\r\n\r\n            form.addEventListener('submit', submitHandler);\r\n            this.baseTable._listeners.push({\r\n                el: form,\r\n                ev: 'submit',\r\n                fn: submitHandler\r\n            });\r\n\r\n            const cancelHandler = () => {\r\n                if (!resolvedOnce)\r\n                    resolve(null);\r\n                try {\r\n                    form.removeEventListener('submit', submitHandler);\r\n                } catch (e) {}\r\n                modalBuilder.close();\r\n            };\r\n\r\n            const cancelBtn = form.querySelector('[data-action=\"cancel\"]');\r\n            if (cancelBtn) {\r\n                const onCancel = (e) => {\r\n                    e.preventDefault();\r\n                    cancelHandler();\r\n                };\r\n                cancelBtn.addEventListener('click', onCancel);\r\n                this.baseTable._listeners.push({\r\n                    el: cancelBtn,\r\n                    ev: 'click',\r\n                    fn: onCancel\r\n                });\r\n            }\r\n\r\n            const closeBtn = dialog.querySelector('button[data-action=\"close\"]') || dialog.querySelector('.btn-ghost');\r\n            if (closeBtn) {\r\n                const onClose = cancelHandler;\r\n                closeBtn.addEventListener('click', onClose);\r\n                this.baseTable._listeners.push({\r\n                    el: closeBtn,\r\n                    ev: 'click',\r\n                    fn: onClose\r\n                });\r\n            }\r\n        });\r\n\r\n        return {\r\n            promise,\r\n            close: () => {\r\n                try {\r\n                    modalBuilder.close();\r\n                } catch (e) {}\r\n            }\r\n        };\r\n    }\r\n\r\n    async openEditModal(id) {\r\n        const item = this.baseTable.data.find(d => String(d[this.baseTable.idField]) === String(id));\r\n        const {\r\n            promise\r\n        } = this._openFormForItem(item || {\r\n            [this.baseTable.idField]: id\r\n        });\r\n        const saved = await promise;\r\n        let table = document.querySelector('table');\r\n        if (saved && saved.type === \"success\") {\r\n            this.baseTable.applyFiltersAndRender();\r\n            this._closeModal();\r\n            this.baseTable.refresh();\r\n        }\r\n        try {\r\n            if (table && window.$)\r\n                $(table).notify(saved?.message, saved?.type);\r\n        } catch (e) {}\r\n    }\r\n\r\n    _defaultModalBuilder() {\r\n        return {\r\n            open: (title, contentNode) => {\r\n                if (this.baseTable._modal)\r\n                    this._closeModal();\r\n                const overlay = this.baseTable._create('div', {\r\n                    className: 'pe-modal-overlay',\r\n                    attrs: {\r\n                        role: 'dialog',\r\n                        'aria-modal': 'true'\r\n                    }\r\n                });\r\n                const dialog = this.baseTable._create('div', {\r\n                    className: 'pe-modal-dialog'\r\n                });\r\n                overlay.appendChild(dialog);\r\n                document.body.appendChild(overlay);\r\n                this.baseTable._modal = {\r\n                    overlay,\r\n                    dialog,\r\n                    focusRestore: document.activeElement\r\n                };\r\n\r\n                const header = this.baseTable._create('div', {\r\n                    className: 'pe-modal-header'\r\n                });\r\n                const h = this.baseTable._create('h4', {\r\n                    className: 'modal-title',\r\n                    text: title\r\n                });\r\n                const close = this.baseTable._create('button', {\r\n                    className: 'btn btn-ghost',\r\n                    text: '\u2715',\r\n                    attrs: {\r\n                        'data-action': 'close',\r\n                        'aria-label': 'Close'\r\n                    }\r\n                });\r\n                header.appendChild(h);\r\n                header.appendChild(close);\r\n                dialog.appendChild(header);\r\n\r\n                const content = this.baseTable._create('div', {\r\n                    className: 'pe-modal-content'\r\n                });\r\n                if (typeof contentNode === 'string')\r\n                    content.innerHTML = contentNode;\r\n                else if (contentNode instanceof Node)\r\n                    content.appendChild(contentNode);\r\n                dialog.appendChild(content);\r\n\r\n                overlay.style.display = 'flex';\r\n                close.addEventListener('click', () => this._closeModal());\r\n                overlay.addEventListener('click', (e) => {\r\n                    if (e.target === overlay)\r\n                        this._closeModal();\r\n                });\r\n                setTimeout(() => {\r\n                    const focusEl = dialog.querySelector('input,select,textarea,button');\r\n                    if (focusEl)\r\n                        try {\r\n                            focusEl.focus();\r\n                        } catch (e) {}\r\n                }, 40);\r\n                return {\r\n                    overlay,\r\n                    dialog\r\n                };\r\n            },\r\n            close: () => this._closeModal()\r\n        };\r\n    }\r\n\r\n    async openAddModal() {\r\n        const {\r\n            promise\r\n        } = this._openFormForItem({});\r\n        const saved = await promise;\r\n        if (saved)\r\n            this.baseTable.applyFiltersAndRender();\r\n        this._closeModal();\r\n    }\r\n\r\n    _closeModal() {\r\n        if (!this.baseTable._modal)\r\n            return;\r\n        try {\r\n            const {\r\n                overlay,\r\n                focusRestore\r\n            } = this.baseTable._modal;\r\n            overlay.remove();\r\n            if (focusRestore && typeof focusRestore.focus === 'function')\r\n                focusRestore.focus();\r\n        } catch (e) {\r\n            this.baseTable.warn('_closeModal error', e);\r\n        }\r\n        this.baseTable._modal = null;\r\n    }\r\n}", "/**\r\n * BaseTable\r\n * Table renders Registry\r\n *\r\n * @author {string} Calista Verner\r\n * @version 1.4.2\r\n * @license MIT\r\n */\r\n\r\nexport class RendererRegistry {\r\n  constructor(baseTable) {\r\n    this.baseTable = baseTable;\r\n  }\r\n\r\n    registerTypeRenderer(type, fn) {\r\n        if (!type || typeof fn !== 'function')\r\n            throw new Error('registerTypeRenderer(type, fn) invalid args');\r\n        this.baseTable.typeRenderers.set(String(type), fn);\r\n        this.baseTable.log('Registered renderer:' + type);\r\n    }\r\n\t\r\n\t    _registerDefaults() {\r\n        this.registerTypeRenderer('text', (td, val, col) => {\r\n            const s = val == null ? '' : String(val);\r\n            const max = col.maxLength || col.truncate || 0;\r\n            if (max && s.length > max) {\r\n                const short = s.slice(0, max - 1) + '\u2026';\r\n                const span = this.baseTable._create('span', {\r\n                    text: short\r\n                });\r\n                span.title = s;\r\n                td.appendChild(span);\r\n            } else\r\n                td.textContent = s;\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('link', (td, val, col, row) => {\r\n            if (!val) {\r\n                td.textContent = '\u2014';\r\n                return;\r\n            }\r\n            const href = String(val);\r\n            const allowed = /^(https?:|mailto:|\\/)/i;\r\n            const safeHref = allowed.test(href) ? href : ('//' + href.replace(/^[\\/]+/, ''));\r\n            const a = this.baseTable._create('a', {\r\n                attrs: {\r\n                    href: safeHref,\r\n                    target: '_blank',\r\n                    rel: 'noopener noreferrer'\r\n                }\r\n            });\r\n            a.textContent = col.textKey ? (this.baseTable._valueForField(col.textKey, row) || '') : (col.display || String(val));\r\n            td.appendChild(a);\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('image', (td, val, col) => {\r\n            const img = document.createElement('img');\r\n            img.src = val || this.baseTable.placeholderSVG(80, 80);\r\n            //img.alt = String((col.altKey && this.baseTable._valueForField(col.altKey, {})) || col.altText || '');\r\n            img.className = 'image';\r\n            img.loading = 'lazy';\r\n            img.addEventListener('error', () => {\r\n                try {\r\n                    img.src = this.baseTable.placeholderSVG(80, 80);\r\n                } catch (e) {}\r\n            }\r\n            );\r\n            td.appendChild(img);\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('date', (td, val, col) => {\r\n            if (val === undefined || val === null || val === '') {\r\n                td.textContent = '\u2014';\r\n                return;\r\n            }\r\n            const date = this.baseTable._parseToDate(val);\r\n            if (!date || isNaN(date.getTime())) {\r\n                td.textContent = String(val);\r\n                return;\r\n            }\r\n            const opts = col.dateFormat || {\r\n                year: 'numeric',\r\n                month: 'short',\r\n                day: '2-digit',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n            };\r\n            try {\r\n                const txt = date.toLocaleString(col.locale || 'ru-RU', opts);\r\n                td.textContent = txt;\r\n                td.title = date.toISOString();\r\n                td.setAttribute('data-timestamp', String(Math.floor(date.getTime() / 1000)));\r\n                td.className = \"unixDate\";\r\n            } catch (e) {\r\n                td.textContent = date.toString();\r\n            }\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('number', (td, val, col) => {\r\n            const n = Number(val);\r\n            if (Number.isNaN(n)) {\r\n                td.textContent = String(val ?? '\u2014');\r\n                return;\r\n            }\r\n            td.textContent = (typeof col.formatPrice === 'function') ? col.formatPrice(n) : n.toLocaleString();\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('boolean', (td, val) => {\r\n            td.textContent = (val ? '\u0414\u0430' : '\u041D\u0435\u0442');\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('price', (td, val, col={}, row={}) => {\r\n            const raw = (val === undefined || val === null || val === '') ? 0 : Number(String(val).replace(/\\s+/g, '').replace(',', '.'));\r\n            const n = Number.isFinite(raw) ? raw : 0;\r\n            const currency = String(col.currency || this.baseTable.options.currency || 'RUB').toUpperCase();\r\n            const maxFrac = (typeof col.maximumFractionDigits === 'number') ? col.maximumFractionDigits : 0;\r\n            try {\r\n                const fmt = new Intl.NumberFormat(col.locale || 'ru-RU',{\r\n                    style: 'currency',\r\n                    currency,\r\n                    maximumFractionDigits: maxFrac,\r\n                    minimumFractionDigits: 0\r\n                });\r\n                td.innerHTML = `<div class=\"price\" data-currency=\"${BaseTable.escapeHtml(currency)}\">${fmt.format(n)}</div>`;\r\n            } catch (e) {\r\n                const formatted = (n).toLocaleString('ru-RU', {\r\n                    maximumFractionDigits: maxFrac\r\n                });\r\n                td.textContent = (currency ? `${formatted} ${currency}` : formatted);\r\n            }\r\n            try {\r\n                td.setAttribute('data-raw', String(n));\r\n            } catch (_) {}\r\n            td.classList.add('cell-price');\r\n        }\r\n        );\r\n\r\n        this.registerTypeRenderer('json', (td, val, col={}, row={}) => {\r\n            // empty / null\r\n            if (val === undefined || val === null || val === '') {\r\n                td.textContent = '\u2014';\r\n                return;\r\n            }\r\n\r\n            // parse if string\r\n            let obj = val;\r\n            if (typeof val === 'string') {\r\n                try {\r\n                    obj = JSON.parse(val);\r\n                } catch (e) {\r\n                    /* not valid JSON, just show string */\r\n                    td.textContent = String(val);\r\n                    return;\r\n                }\r\n            }\r\n\r\n            const maxDepth = Number.isFinite(col.maxDepth) ? Math.max(0, col.maxDepth) : 2;\r\n            const maxItems = Number.isFinite(col.maxItems) ? Math.max(1, col.maxItems) : 50;\r\n            const linkify = col.linkify === true;\r\n\r\n            const renderPrimitive = (v) => {\r\n                if (v === null || v === undefined)\r\n                    return document.createTextNode('\u2014');\r\n                if (typeof v === 'string') {\r\n                    const s = v;\r\n                    if (linkify && /^(https?:\\/\\/|\\/\\/)/i.test(s)) {\r\n                        const a = document.createElement('a');\r\n                        a.href = s.startsWith('//') ? (location.protocol + s) : s;\r\n                        a.target = '_blank';\r\n                        a.rel = 'noopener noreferrer';\r\n                        a.textContent = s;\r\n                        return a;\r\n                    }\r\n                    return document.createTextNode(String(s));\r\n                }\r\n                if (typeof v === 'boolean' || typeof v === 'number')\r\n                    return document.createTextNode(String(v));\r\n                // fallback for other types\r\n                return document.createTextNode(String(v));\r\n            }\r\n            ;\r\n\r\n            const createList = (value, depth=0) => {\r\n                const ul = document.createElement('ul');\r\n                ul.className = 'bt-json-render';\r\n                ul.style.margin = '6px 0 0 0';\r\n                ul.style.paddingLeft = '18px';\r\n                if (depth > maxDepth) {\r\n                    const li = document.createElement('li');\r\n                    li.textContent = '\u2026';\r\n                    ul.appendChild(li);\r\n                    return ul;\r\n                }\r\n\r\n                if (Array.isArray(value)) {\r\n                    const len = Math.min(value.length, maxItems);\r\n                    for (let i = 0; i < len; i++) {\r\n                        const v = value[i];\r\n                        const li = document.createElement('li');\r\n                        const strong = document.createElement('strong');\r\n                        strong.textContent = `${i}: `;\r\n                        li.appendChild(strong);\r\n                        if (v && typeof v === 'object')\r\n                            li.appendChild(createList(v, depth + 1));\r\n                        else\r\n                            li.appendChild(renderPrimitive(v));\r\n                        ul.appendChild(li);\r\n                    }\r\n                    if (value.length > maxItems) {\r\n                        const li = document.createElement('li');\r\n                        li.textContent = `... ${value.length - maxItems} more`;\r\n                        ul.appendChild(li);\r\n                    }\r\n                    return ul;\r\n                }\r\n\r\n                if (value && typeof value === 'object') {\r\n                    const entries = Object.entries(value);\r\n                    const len = Math.min(entries.length, maxItems);\r\n                    for (let i = 0; i < len; i++) {\r\n                        const [k,v] = entries[i];\r\n                        const li = document.createElement('li');\r\n                        const keyNode = document.createElement('strong');\r\n                        keyNode.textContent = `${k}: `;\r\n                        li.appendChild(keyNode);\r\n                        if (v && typeof v === 'object')\r\n                            li.appendChild(createList(v, depth + 1));\r\n                        else\r\n                            li.appendChild(renderPrimitive(v));\r\n                        ul.appendChild(li);\r\n                    }\r\n                    if (entries.length > maxItems) {\r\n                        const li = document.createElement('li');\r\n                        li.textContent = `... ${entries.length - maxItems} more`;\r\n                        ul.appendChild(li);\r\n                    }\r\n                    return ul;\r\n                }\r\n\r\n                // fallback\r\n                const li = document.createElement('li');\r\n                li.appendChild(renderPrimitive(value));\r\n                ul.appendChild(li);\r\n                return ul;\r\n            }\r\n            ;\r\n\r\n            try {\r\n                td.classList.add('cell-json');\r\n                td.appendChild(createList(obj, 0));\r\n                try {\r\n                    td.setAttribute('data-json', BaseTable.escapeHtml(JSON.stringify(obj)));\r\n                } catch (_) {}\r\n            } catch (err) {\r\n                // if any error \u2014 fallback to string representation\r\n                td.textContent = String(val);\r\n            }\r\n        }\r\n        );\r\n\r\n    }\r\n}", "/**\r\n * BaseTable\r\n * Main class for working with the BaseTable\r\n *\r\n * @author {string} Calista Verner\r\n * @version 1.4.2\r\n * @license MIT\r\n */\r\n\r\nimport {Table} from './Table.js';\r\nimport {Modal} from './Modal.js';\r\nimport {RendererRegistry} from './RendererRegistry.js';\r\n\r\nexport class BaseTable {\r\n    constructor(adminPanel=null, options={}) {\r\n        this.adminPanel = adminPanel;\r\n        this.options = options || {};\r\n        this.typeRenderers = new Map();\r\n        this.table = new Table(this);\r\n\t\tthis.modal = new Modal(this);\r\n\t\tthis.renderRegistry = new RendererRegistry(this);\r\n\r\n        this._meta = {\r\n            author: 'Calista Verner',\r\n            version: options.version || '1.4.2',\r\n            license: options.license || 'MIT'\r\n        };\r\n\r\n        const defaultSelectors = {\r\n            container: options.selectors?.container || 'adminContent',\r\n            tbody: options.selectors?.tbody || 'tbody',\r\n            search: options.selectors?.search || 'search',\r\n            clear: options.selectors?.clear || 'clear',\r\n            count: options.selectors?.count || 'count',\r\n            noResults: options.selectors?.noResults || 'noResults',\r\n            table: options.selectors?.table || 'table',\r\n            add: options.selectors?.add || 'add',\r\n            loading: options.selectors?.loading || 'bt-loading'\r\n        };\r\n\r\n        this.selectors = Object.assign({}, defaultSelectors, options.selectors || {});\r\n        this.container = (typeof this.selectors.container === 'string') ? (document.getElementById(this.selectors.container) || document.querySelector(this.selectors.container) || document.body) : (this.selectors.container || document.body);\r\n\r\n        this.idField = options.idField || 'id';\r\n        this.columns = options.columns || [];\r\n        this.formSchema = options.formSchema || [];\r\n        this.placeholderLabel = options.placeholderLabel || '\u041D\u0435\u0442 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F';\r\n\r\n        this.apis = Object.assign({\r\n            apiCall: null,\r\n            apiAdd: null,\r\n            apiUpdate: null,\r\n            apiDelete: null,\r\n            refs: {}\r\n        }, options.apis || {});\r\n\r\n        this.actions = options.actions || [{\r\n            label: '\u0418\u0437\u043C\u0435\u043D.',\r\n            action: 'edit',\r\n            className: 'btn btn-sm btn-outline-primary me-1',\r\n            title: '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C'\r\n        }, {\r\n            label: '\u0423\u0434\u0430\u043B.',\r\n            action: 'delete',\r\n            className: 'btn btn-sm btn-outline-danger',\r\n            title: '\u0423\u0434\u0430\u043B\u0438\u0442\u044C'\r\n        }];\r\n\r\n        this.ui = Object.assign({\r\n            showLoadingOverlay: true,\r\n            loadingSelector: this.selectors.loading,\r\n            createLoadingElement: null,\r\n            modalBuilder: null,\r\n            formBuilder: null\r\n        }, options.ui || {});\r\n\r\n        this.brandTag = options.brandName || (adminPanel && adminPanel.brandName) || 'BaseTable';\r\n\r\n        this.data = [];\r\n        this.refs = {};\r\n        this._refsLoading = null;\r\n        this._refsLoaded = false;\r\n\r\n        this.state = {\r\n            q: '',\r\n            sortBy: null,\r\n            sortDir: 1\r\n        };\r\n\r\n        this._els = {};\r\n        this.bound = {};\r\n        this._modal = null;\r\n        this._isSaving = false;\r\n\r\n        // unified listeners registry (for attach/detach)\r\n        this._listeners = [];\r\n\r\n        this.options.currency = this.options.currency || 'RUB';\r\n\r\n        // small helper bindings\r\n        this._formatNumberToLocale = (n) => {\r\n            try {\r\n                return n.toLocaleString('ru-RU', {\r\n                    maximumFractionDigits: 0\r\n                });\r\n            } catch {\r\n                return String(n);\r\n            }\r\n        }\r\n        ;\r\n\r\n        // register default renderers\r\n        this.renderRegistry._registerDefaults();\r\n\r\n        // price helpers bound\r\n        this._livePriceInputHandler = this._livePriceInputHandler.bind(this);\r\n        this._priceMaskCleanup = this._priceMaskCleanup.bind(this);\r\n        document.addEventListener('focusin', this._priceMaskHandler);\r\n    }\r\n\r\n    _livePriceInputHandler(e) {\r\n        const el = e.target;\r\n        if (!el || el.tagName !== 'INPUT')\r\n            return;\r\n        // naive live formatter: keep only digits, then format to locale with spaces\r\n        const raw = String(el.value || '').replace(/\\s+/g, '').replace(/[^\\d,.-]/g, '').replace(',', '.');\r\n        const num = Number(raw);\r\n        if (!Number.isFinite(num))\r\n            return;\r\n        const formatted = this._formatNumberToLocale(Math.trunc(num));\r\n        const pos = el.selectionStart || el.value.length;\r\n        el.value = formatted;\r\n        try {\r\n            el.setSelectionRange(el.value.length, el.value.length);\r\n        } catch (_) {}\r\n    }\r\n\r\n    _priceMaskCleanup(el) {\r\n        if (!el)\r\n            return;\r\n        // nothing special for plugin cleanup - just mark removed if needed\r\n        if (el.dataset)\r\n            delete el.dataset.priceMaskApplied;\r\n    }\r\n\r\n    _applyPriceMaskToElement(el, initialVal) {\r\n        if (!el || el.tagName !== 'INPUT')\r\n            return;\r\n        // if already applied, try to update initial value if provided\r\n        if (el.dataset && el.dataset.priceMaskApplied) {\r\n            if (initialVal === undefined || initialVal === null || String(initialVal) === '')\r\n                return;\r\n            try {\r\n                if (window.jQuery && typeof jQuery.fn.mask === 'function') {\r\n                    jQuery(el).val(String(initialVal)).trigger('input');\r\n                    return;\r\n                }\r\n                if (window.jQuery && typeof jQuery.fn.maskMoney === 'function') {\r\n                    const num = Number(String(initialVal).replace(/\\s+/g, '').replace(',', '.')) || 0;\r\n                    jQuery(el).maskMoney('mask', num);\r\n                    return;\r\n                }\r\n            } catch (err) {// plugin error -> fallback below\r\n            }\r\n            // fallback formatting if plugins not available\r\n            try {\r\n                const raw = String(initialVal).replace(/\\s+/g, '').replace(',', '.');\r\n                const num = Number(raw);\r\n                if (Number.isFinite(num))\r\n                    el.value = this._formatNumberToLocale(Math.trunc(num));\r\n            } catch (_) {}\r\n            return;\r\n        }\r\n\r\n        // mark as applied (first time)\r\n        if (el.dataset)\r\n            el.dataset.priceMaskApplied = '1';\r\n\r\n        try {\r\n            if (window.jQuery && typeof jQuery.fn.mask === 'function') {\r\n                jQuery(el).mask('000 000 000 000', {\r\n                    reverse: true\r\n                });\r\n                if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                    jQuery(el).val(String(initialVal)).trigger('input');\r\n                } else {\r\n                    jQuery(el).trigger('input');\r\n                }\r\n                return;\r\n            }\r\n\r\n            if (window.jQuery && typeof jQuery.fn.maskMoney === 'function') {\r\n                jQuery(el).maskMoney({\r\n                    thousands: ' ',\r\n                    decimal: ',',\r\n                    allowZero: true,\r\n                    precision: 0\r\n                });\r\n                if (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') {\r\n                    const num = Number(String(initialVal).replace(/\\s+/g, '').replace(',', '.')) || 0;\r\n                    jQuery(el).maskMoney('mask', num);\r\n                } else {\r\n                    jQuery(el).maskMoney('mask');\r\n                }\r\n                return;\r\n            }\r\n        } catch (err) {// plugin error -> fallback\r\n        }\r\n\r\n        // fallback: attach input listener for live formatting and format initial value\r\n        const handler = this._livePriceInputHandler;\r\n        el.addEventListener('input', handler);\r\n        this._listeners.push({\r\n            el,\r\n            ev: 'input',\r\n            fn: handler\r\n        });\r\n        // initial formatting\r\n        try {\r\n            const raw = (initialVal !== undefined && initialVal !== null && String(initialVal) !== '') ? String(initialVal).replace(/\\s+/g, '').replace(',', '.') : (el.value || '').replace(/\\s+/g, '').replace(',', '.');\r\n            const num = Number(raw);\r\n            if (Number.isFinite(num))\r\n                el.value = this._formatNumberToLocale(Math.trunc(num));\r\n        } catch (_) {}\r\n    }\r\n\r\n    meta() {\r\n        return {\r\n            ...this._meta\r\n        };\r\n    }\r\n\r\n    _logPrefixStyle() {\r\n        return ['background:#0ea5a4;color:#fff;padding:4px 8px;border-radius:6px;font-weight:700', 'color:#374151'];\r\n    }\r\n    _console(method, ...args) {\r\n        try {\r\n            const prefix = `%c ${this.brandTag} %c`;\r\n            console[method](prefix, ...this._logPrefixStyle(), ...args);\r\n        } catch (e) {\r\n            console[method](this.brandTag, ...args);\r\n        }\r\n    }\r\n    log(...args) {\r\n        this._console('log', ...args);\r\n    }\r\n    info(...args) {\r\n        this._console('info', ...args);\r\n    }\r\n    warn(...args) {\r\n        try {\r\n            const p1 = 'background:#f59e0b;color:#fff;padding:4px 8px;border-radius:6px;font-weight:700';\r\n            console.warn(`%c ${this.brandTag} %c`, p1, 'color:#374151', ...args);\r\n        } catch (e) {\r\n            console.warn(this.brandTag, ...args);\r\n        }\r\n    }\r\n    error(...args) {\r\n        try {\r\n            const p1 = 'background:#ef4444;color:#fff;padding:4px 8px;border-radius:6px;font-weight:700';\r\n            console.error(`%c ${this.brandTag} %c`, p1, 'color:#fff', ...args);\r\n        } catch (e) {\r\n            console.error(this.brandTag, ...args);\r\n        }\r\n    }\r\n\r\n    _parseToDate(val) {\r\n        if (!val && val !== 0)\r\n            return null;\r\n        if (val instanceof Date)\r\n            return val;\r\n        const tryNumber = (v) => {\r\n            const n = Number(v);\r\n            if (Number.isNaN(n))\r\n                return null;\r\n            const absStr = String(Math.trunc(Math.abs(n)));\r\n            if (absStr.length <= 10)\r\n                return new Date(n * 1000);\r\n            return new Date(n);\r\n        }\r\n        ;\r\n        if (typeof val === 'number')\r\n            return tryNumber(val);\r\n        if (typeof val === 'string') {\r\n            const s = val.trim();\r\n            if (/^[+-]?\\d+$/.test(s))\r\n                return tryNumber(s);\r\n            const parsed = Date.parse(s);\r\n            if (!Number.isNaN(parsed))\r\n                return new Date(parsed);\r\n            return null;\r\n        }\r\n        try {\r\n            const j = JSON.stringify(val);\r\n            const parsed = Date.parse(j);\r\n            if (!Number.isNaN(parsed))\r\n                return new Date(parsed);\r\n        } catch (e) {}\r\n        return null;\r\n    }\r\n\r\n    static escapeHtml(s) {\r\n        return String(s ?? '').replace(/[&<>\"']/g, m => ({\r\n            '&': '&amp;',\r\n            '<': '&lt;',\r\n            '>': '&gt;',\r\n            '\"': '&quot;',\r\n            \"'\": '&#39;'\r\n        }[m]));\r\n    }\r\n\r\n    placeholderSVG(w=80, h=80, label=null) {\r\n        const text = BaseTable.escapeHtml(label ?? this.placeholderLabel);\r\n        return 'data:image/svg+xml;utf8,' + encodeURIComponent(`<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${w}\" height=\"${h}\"><rect width=\"100%\" height=\"100%\" fill=\"#f2f6fb\"/><text x=\"50%\" y=\"50%\" fill=\"#9aa6bf\" font-size=\"${Math.max(10, Math.round(w / 8))}\" text-anchor=\"middle\" dominant-baseline=\"middle\">${text}</text></svg>`);\r\n    }\r\n\r\n    registerTypeRenderer(type, fn) {\r\n        if (!type || typeof fn !== 'function')\r\n            throw new Error('registerTypeRenderer(type, fn) invalid args');\r\n        this.typeRenderers.set(String(type), fn);\r\n        this.log('Registered renderer:' + type);\r\n    }\r\n\r\n    getByPath(obj, path) {\r\n        if (!obj || !path)\r\n            return undefined;\r\n        if (path.indexOf('.') === -1)\r\n            return obj[path];\r\n        return path.split('.').reduce( (cur, p) => (cur && cur[p] !== undefined ? cur[p] : undefined), obj);\r\n    }\r\n\r\n    _inferTypeFromValue(val) {\r\n        if (val == null)\r\n            return 'text';\r\n        if (typeof val === 'boolean')\r\n            return 'boolean';\r\n        if (typeof val === 'number')\r\n            return 'number';\r\n        if (val instanceof Date)\r\n            return 'date';\r\n        const s = String(val);\r\n        if (/^\\d{4}-\\d{2}-\\d{2}T/.test(s) || /^\\d{4}-\\d{2}-\\d{2}/.test(s) || /^\\d{10,13}$/.test(s))\r\n            return 'date';\r\n        if (/\\.(png|jpe?g|gif|webp|svg)(\\?.*)?$/i.test(s))\r\n            return 'image';\r\n        if (/^https?:\\/\\//i.test(s) || /^mailto:/i.test(s) || /^\\/\\//.test(s))\r\n            return 'link';\r\n        return 'text';\r\n    }\r\n\r\n    _valueForField(field, row) {\r\n        if (!field)\r\n            return undefined;\r\n        if (typeof field === 'function')\r\n            return field(row);\r\n        if (typeof field === 'string')\r\n            return this.getByPath(row, field);\r\n        return undefined;\r\n    }\r\n\r\n    formatLink(href) {\r\n        return href ? `<a href=\"${BaseTable.escapeHtml(href)}\" target=\"_blank\" rel=\"noopener noreferrer\">${BaseTable.escapeHtml(href)}</a>` : '\u2014';\r\n    }\r\n\r\n    formatPrice(v) {\r\n        if (v === null || v === undefined || v === '')\r\n            return '\u2014';\r\n        const n = Number(v);\r\n        if (Number.isNaN(n))\r\n            return String(v);\r\n        return n.toLocaleString('ru-RU', {\r\n            minimumFractionDigits: 0,\r\n            maximumFractionDigits: 2\r\n        });\r\n    }\r\n\r\n    debounce(fn, ms=200) {\r\n        let t;\r\n        return (...a) => {\r\n            clearTimeout(t);\r\n            t = setTimeout( () => fn(...a), ms);\r\n        }\r\n        ;\r\n    }\r\n\r\n    _create(tag, opts={}) {\r\n        const el = document.createElement(tag);\r\n        if (opts.className)\r\n            el.className = opts.className;\r\n        if (opts.text)\r\n            el.textContent = opts.text;\r\n        if (opts.html)\r\n            el.innerHTML = opts.html;\r\n        if (opts.attrs)\r\n            Object.entries(opts.attrs).forEach( ([k,v]) => el.setAttribute(k, v));\r\n        if (opts.props)\r\n            Object.assign(el, opts.props);\r\n        return el;\r\n    }\r\n\r\n    _normalizeListResponse(res) {\r\n        if (!res)\r\n            return [];\r\n        if (Array.isArray(res))\r\n            return res;\r\n        if (res.result && Array.isArray(res.result))\r\n            return res.result;\r\n        if (res.data && Array.isArray(res.data))\r\n            return res.data;\r\n        try {\r\n            if (typeof res === 'string')\r\n                return JSON.parse(res);\r\n        } catch (e) {}\r\n        return [];\r\n    }\r\n\r\n    _resolveResponse(res) {\r\n        if (!res)\r\n            return null;\r\n        let candidate = null;\r\n        if (res.item)\r\n            candidate = res.item;\r\n        else if (res.created)\r\n            candidate = res.created;\r\n        else if (res.updated)\r\n            candidate = res.updated;\r\n        else if (res.data)\r\n            candidate = res.data;\r\n        else if (res.result)\r\n            candidate = res.result;\r\n        else\r\n            candidate = res;\r\n        if (Array.isArray(candidate))\r\n            return candidate.length ? candidate[0] : null;\r\n        return candidate;\r\n    }\r\n\r\n    _mergeLocalItem(existing, incoming) {\r\n        if (!existing)\r\n            return incoming;\r\n        return Object.assign({}, existing, incoming);\r\n    }\r\n\r\n    _ensureEls() {\r\n        const c = this.container || document;\r\n        const sel = this.selectors;\r\n        this._els.tbody = c.querySelector(`#${sel.tbody}`) || c.querySelector(sel.tbody) || this._els.tbody;\r\n        this._els.search = c.querySelector(`#${sel.search}`) || c.querySelector(sel.search) || this._els.search;\r\n        this._els.clear = c.querySelector(`#${sel.clear}`) || c.querySelector(sel.clear) || this._els.clear;\r\n        this._els.count = c.querySelector(`#${sel.count}`) || c.querySelector(sel.count) || this._els.count;\r\n        this._els.noResults = c.querySelector(`#${sel.noResults}`) || c.querySelector(sel.noResults) || this._els.noResults;\r\n        this._els.table = c.querySelector(`#${sel.table}`) || c.querySelector(sel.table) || this._els.table;\r\n        this._els.add = c.querySelector(`#${sel.add}`) || c.querySelector(sel.add) || this._els.add;\r\n        this._els.loading = c.querySelector(`#${this.ui.loadingSelector || sel.loading}`) || c.querySelector(this.ui.loadingSelector || sel.loading) || this._els.loading;\r\n    }\r\n\r\n    _createDefaultLoading() {\r\n        const overlay = this._create('div', {\r\n            className: 'bt-loading-overlay',\r\n            attrs: {\r\n                role: 'status',\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n        const inner = this._create('div', {\r\n            className: 'bt-loading-inner',\r\n            attrs: {\r\n                'aria-live': 'polite'\r\n            }\r\n        });\r\n        const spinner = this._create('i', {\r\n            className: 'fa-solid fa-spinner fa-spin bt-fa-spinner',\r\n            attrs: {\r\n                'aria-hidden': 'true'\r\n            }\r\n        });\r\n        const label = this._create('div', {\r\n            className: 'bt-loading-text',\r\n            text: '\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430...'\r\n        });\r\n        inner.appendChild(spinner);\r\n        inner.appendChild(label);\r\n        overlay.appendChild(inner);\r\n        Object.assign(overlay.style, {\r\n            position: 'absolute',\r\n            inset: '0',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            background: 'rgba(255,255,255,0.6)',\r\n            zIndex: 9998,\r\n            pointerEvents: 'none'\r\n        });\r\n        Object.assign(inner.style, {\r\n            display: 'inline-flex',\r\n            gap: '10px',\r\n            alignItems: 'center',\r\n            padding: '8px 12px',\r\n            borderRadius: '10px',\r\n            background: 'rgba(255,255,255,0.95)',\r\n            boxShadow: '0 6px 20px rgba(20,30,50,0.08)',\r\n            pointerEvents: 'auto'\r\n        });\r\n        return overlay;\r\n    }\r\n\r\n    showLoading(msg='') {\r\n        if (!this.ui.showLoadingOverlay)\r\n            return;\r\n        this._ensureEls();\r\n        if (typeof this.ui.createLoadingElement === 'function') {\r\n            try {\r\n                if (!this._els._customLoading) {\r\n                    this._els._customLoading = this.ui.createLoadingElement(this._els.table || this.container, msg);\r\n                    if (this._els._customLoading)\r\n                        (this._els.table || this.container || document.body).appendChild(this._els._customLoading);\r\n                }\r\n                if (this._els._customLoading) {\r\n                    this._els._customLoading.style.display = '';\r\n                    this._els._customLoading.setAttribute('aria-hidden', 'false');\r\n                }\r\n            } catch (e) {\r\n                this.error('createLoadingElement error', e);\r\n            }\r\n            return;\r\n        }\r\n        if (!this._els._autoLoading) {\r\n            this._els._autoLoading = this._createDefaultLoading();\r\n            const parent = this._els.table || this.container || document.body;\r\n            const cs = getComputedStyle(parent);\r\n            if (cs.position === 'static')\r\n                parent.style.position = 'relative';\r\n            parent.appendChild(this._els._autoLoading);\r\n        }\r\n        if (msg) {\r\n            const txt = this._els._autoLoading.querySelector('.bt-loading-text');\r\n            if (txt)\r\n                txt.textContent = msg;\r\n        }\r\n        this._els._autoLoading.style.display = 'flex';\r\n        this._els._autoLoading.setAttribute('aria-hidden', 'false');\r\n    }\r\n\r\n    hideLoading() {\r\n        setTimeout( () => {\r\n            try {\r\n                if (this._els._customLoading) {\r\n                    this._els._customLoading.style.display = 'none';\r\n                    this._els._customLoading.setAttribute('aria-hidden', 'true');\r\n                }\r\n            } catch (e) {}\r\n            try {\r\n                if (this._els.loading) {\r\n                    this._els.loading.style.display = 'none';\r\n                    this._els.loading.setAttribute('aria-hidden', 'true');\r\n                }\r\n            } catch (e) {}\r\n            try {\r\n                if (this._els._autoLoading) {\r\n                    this._els._autoLoading.style.display = 'none';\r\n                    this._els._autoLoading.setAttribute('aria-hidden', 'true');\r\n                }\r\n            } catch (e) {}\r\n        }\r\n        , 200);\r\n    }\r\n\r\n    async fetchItems() {\r\n        try {\r\n            this.showLoading('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0434\u0430\u043D\u043D\u044B\u0445...');\r\n            let call = this.apis.apiCall;\r\n            if (!call) {\r\n                if (this.adminPanel?.foxEngine?.sendPostAndGetAnswer) {\r\n                    call = () => this.adminPanel.foxEngine.sendPostAndGetAnswer({\r\n                        sysRequest: \"getCategories\"\r\n                    }, \"JSON\");\r\n                } else if (typeof foxEngine !== 'undefined' && foxEngine.sendPostAndGetAnswer) {\r\n                    call = () => foxEngine.sendPostAndGetAnswer({\r\n                        sysRequest: \"getCategories\"\r\n                    }, \"JSON\");\r\n                } else\r\n                    throw new Error('apiCall not provided');\r\n            }\r\n            const res = await call();\r\n            const list = this._normalizeListResponse(res);\r\n            this.log('items fetched', (list && list.length) || 0);\r\n            return list;\r\n        } catch (err) {\r\n            this.error('fetchItems error', err);\r\n            return [];\r\n        } finally {\r\n            setTimeout( () => this.hideLoading(), 200);\r\n        }\r\n    }\r\n\r\n    createRowFromData(row) {\r\n        const tr = document.createElement('tr');\r\n        if (row[this.idField] !== undefined)\r\n            tr.dataset.id = String(row[this.idField]);\r\n\r\n        for (const col of this.columns) {\r\n            const td = document.createElement('td');\r\n            if (col.className)\r\n                td.className = col.className;\r\n            if (col.width)\r\n                td.style.width = col.width;\r\n            if (col.attrs && typeof col.attrs === 'object') {\r\n                Object.entries(col.attrs).forEach( ([k,v]) => td.setAttribute(k, v));\r\n            }\r\n\r\n            const val = this.getByPath(row, col.key);\r\n\r\n            if (typeof col.renderer === 'function') {\r\n                try {\r\n                    const out = col.renderer(val, row, {\r\n                        table: this,\r\n                        col\r\n                    });\r\n                    if (typeof out === 'string')\r\n                        td.innerHTML = out;\r\n                    else if (out instanceof Node)\r\n                        td.appendChild(out);\r\n                    else\r\n                        td.textContent = out ?? '';\r\n                } catch (e) {\r\n                    this.error('col.renderer error', e);\r\n                    td.textContent = String(val ?? '');\r\n                }\r\n                tr.appendChild(td);\r\n                continue;\r\n            }\r\n\r\n            const type = col.type || this._inferTypeFromValue(val);\r\n            const renderer = this.typeRenderers.get(type);\r\n            if (typeof renderer !== 'function') {\r\n                td.textContent = String(val ?? '');\r\n                tr.appendChild(td);\r\n                continue;\r\n            }\r\n\r\n            try {\r\n                renderer.call(this, td, val, col, row, {\r\n                    escapeHtml: BaseTable.escapeHtml,\r\n                    formatPrice: this.formatPrice?.bind(this)\r\n                });\r\n            } catch (e) {\r\n                this.error('type renderer error', e);\r\n                td.textContent = String(val ?? '');\r\n            }\r\n\r\n            tr.appendChild(td);\r\n        }\r\n\r\n        if (this.actions && this.actions.length) {\r\n            const tdActions = document.createElement('td');\r\n            tdActions.className = 'text-end';\r\n            for (const a of this.actions) {\r\n                const btn = document.createElement('button');\r\n                btn.type = 'button';\r\n                btn.className = a.className || 'btn btn-sm btn-outline-secondary';\r\n                btn.textContent = a.label;\r\n                if (a.title)\r\n                    btn.title = a.title;\r\n                if (a.action)\r\n                    btn.dataset.action = a.action;\r\n                btn.dataset.id = row[this.idField];\r\n                if (a.attrs)\r\n                    Object.entries(a.attrs).forEach( ([k,v]) => btn.setAttribute(k, v));\r\n                tdActions.appendChild(btn);\r\n                if (typeof a.after === 'function') {\r\n                    try {\r\n                        a.after(btn, row);\r\n                    } catch (e) {\r\n                        this.error('action.after', e);\r\n                    }\r\n                }\r\n            }\r\n            tr.appendChild(tdActions);\r\n        }\r\n\r\n        return tr;\r\n    }\r\n\r\n    matches(row, q) {\r\n        if (!q)\r\n            return true;\r\n        q = q.toLowerCase();\r\n        for (const col of this.columns) {\r\n            const v = String(row[col.key] ?? '').toLowerCase();\r\n            if (v.includes(q))\r\n                return true;\r\n        }\r\n        if (String(row[this.idField] ?? '').toLowerCase().includes(q))\r\n            return true;\r\n        return false;\r\n    }\r\n\r\n    applyFiltersAndRender() {\r\n        let list = (this.data || []).filter(r => this.matches(r, this.state.q));\r\n        if (this.state.sortBy) {\r\n            const key = this.state.sortBy;\r\n            const dir = this.state.sortDir === 1 ? 1 : -1;\r\n            list.sort( (a, b) => {\r\n                let va = a[key]\r\n                  , vb = b[key];\r\n                if (typeof va === 'number' || typeof vb === 'number') {\r\n                    va = Number(va || 0);\r\n                    vb = Number(vb || 0);\r\n                    return (va - vb) * dir;\r\n                }\r\n                va = String(va ?? '').toLowerCase();\r\n                vb = String(vb ?? '').toLowerCase();\r\n                if (va === vb)\r\n                    return 0;\r\n                return va > vb ? dir : -dir;\r\n            }\r\n            );\r\n        }\r\n        this.renderTable(list);\r\n    }\r\n\r\n    renderTable(list) {\r\n        this._ensureEls();\r\n        const tbody = this._els.tbody;\r\n        const countEl = this._els.count;\r\n        const noResults = this._els.noResults;\r\n        if (!tbody) {\r\n            this.warn('tbody not found');\r\n            return;\r\n        }\r\n\r\n        tbody.innerHTML = '';\r\n        if (!list || !list.length) {\r\n            if (noResults)\r\n                noResults.style.display = '';\r\n            if (countEl)\r\n                countEl.textContent = '0';\r\n            return;\r\n        }\r\n        if (noResults)\r\n            noResults.style.display = 'none';\r\n\r\n        const frag = document.createDocumentFragment();\r\n        for (const row of list)\r\n            frag.appendChild(this.createRowFromData(row));\r\n        tbody.appendChild(frag);\r\n        if (countEl)\r\n            countEl.textContent = `${list.length} \u0437\u0430\u043F\u0438\u0441\u0435\u0439`;\r\n    }\r\n\r\n    attachEvents() {\r\n        this._ensureEls();\r\n        const {search, clear, tbody, add} = this._els;\r\n\r\n        if (search) {\r\n            this.bound.onSearch = this.debounce( (e) => {\r\n                this.state.q = e.target.value.trim();\r\n                this.applyFiltersAndRender();\r\n            }\r\n            , 180);\r\n            search.addEventListener('input', this.bound.onSearch);\r\n            this._listeners.push({\r\n                el: search,\r\n                ev: 'input',\r\n                fn: this.bound.onSearch\r\n            });\r\n        }\r\n        if (clear) {\r\n            this.bound.onClear = () => {\r\n                if (this._els.search)\r\n                    this._els.search.value = '';\r\n                this.state.q = '';\r\n                this.applyFiltersAndRender();\r\n            }\r\n            ;\r\n            clear.addEventListener('click', this.bound.onClear);\r\n            this._listeners.push({\r\n                el: clear,\r\n                ev: 'click',\r\n                fn: this.bound.onClear\r\n            });\r\n        }\r\n\r\n        if (tbody) {\r\n            this.bound.onTbodyClick = async (e) => {\r\n                const btn = e.target.closest('button');\r\n                if (!btn)\r\n                    return;\r\n                const action = btn.dataset.action;\r\n                const tr = btn.closest('tr');\r\n                if (!tr)\r\n                    return;\r\n                const id = tr.dataset.id;\r\n                if (action === 'edit')\r\n                    return this.modal.openEditModal(id);\r\n                if (action === 'delete')\r\n                    return this.openDeleteConfirm(id);\r\n                if (typeof this.onAction === 'function') {\r\n                    try {\r\n                        await this.onAction(action, id, tr);\r\n                    } catch (e) {\r\n                        this.error('onAction error', e);\r\n                    }\r\n                }\r\n            }\r\n            ;\r\n            tbody.addEventListener('click', this.bound.onTbodyClick);\r\n            this._listeners.push({\r\n                el: tbody,\r\n                ev: 'click',\r\n                fn: this.bound.onTbodyClick\r\n            });\r\n        }\r\n\r\n        if (add) {\r\n            this.bound.onAdd = () => this.modal.openAddModal();\r\n            add.addEventListener('click', this.bound.onAdd);\r\n            this._listeners.push({\r\n                el: add,\r\n                ev: 'click',\r\n                fn: this.bound.onAdd\r\n            });\r\n        }\r\n\r\n        const ths = (this._els.table || document).querySelectorAll('thead th[data-key]');\r\n        this.bound.onHeaderClick = (e) => {\r\n            const th = e.currentTarget;\r\n            const key = th.dataset.key;\r\n            if (!key)\r\n                return;\r\n            if (this.state.sortBy === key)\r\n                this.state.sortDir = -this.state.sortDir;\r\n            else {\r\n                this.state.sortBy = key;\r\n                this.state.sortDir = 1;\r\n            }\r\n            (this._els.table || document).querySelectorAll('.sort-indicator').forEach(el => el.textContent = '');\r\n            const ind = (this._els.table || document).querySelector('#sort-' + key);\r\n            if (ind)\r\n                ind.textContent = this.state.sortDir === 1 ? '\u25B2' : '\u25BC';\r\n            this.applyFiltersAndRender();\r\n        }\r\n        ;\r\n        ths.forEach(th => {\r\n            th.addEventListener('click', this.bound.onHeaderClick);\r\n            this._listeners.push({\r\n                el: th,\r\n                ev: 'click',\r\n                fn: this.bound.onHeaderClick\r\n            });\r\n        }\r\n        );\r\n    }\r\n\r\n    detachEvents() {\r\n        for (const l of this._listeners) {\r\n            try {\r\n                l.el.removeEventListener(l.ev, l.fn, l.opts || false);\r\n            } catch (e) {}\r\n        }\r\n        this._listeners = [];\r\n        this.bound = {};\r\n    }\r\n\r\n    _ensureModalBuilder() {\r\n        if (typeof this.ui.modalBuilder === 'function')\r\n            return this.ui.modalBuilder(this);\r\n        return this.modal._defaultModalBuilder();\r\n    }\r\n\r\n    async fetchRefs() {\r\n        if (this._refsLoading)\r\n            return this._refsLoading;\r\n        if (this._refsLoaded && this.refs && Object.keys(this.refs).length)\r\n            return this.refs;\r\n\r\n        const refsMap = this.apis.refs || {};\r\n        const keys = Object.keys(refsMap);\r\n        if (!keys.length) {\r\n            this.refs = {};\r\n            this._refsLoaded = true;\r\n            return {};\r\n        }\r\n\r\n        this._refsLoading = (async () => {\r\n            try {\r\n                this.showLoading('\u0417\u0430\u0433\u0440\u0443\u0437\u043A\u0430 \u0441\u043F\u0440\u0430\u0432\u043E\u0447\u043D\u0438\u043A\u043E\u0432...');\r\n                const calls = keys.map(k => {\r\n                    const v = refsMap[k];\r\n                    try {\r\n                        if (typeof v === 'function')\r\n                            return Promise.resolve(v());\r\n                        if (v && typeof v.then === 'function')\r\n                            return v;\r\n                        return Promise.resolve(v);\r\n                    } catch (e) {\r\n                        return Promise.resolve([]);\r\n                    }\r\n                }\r\n                );\r\n\r\n                const settled = await Promise.allSettled(calls);\r\n                keys.forEach( (k, i) => {\r\n                    const r = settled[i];\r\n                    if (r.status === 'fulfilled')\r\n                        this.refs[k] = this._normalizeListResponse(r.value);\r\n                    else {\r\n                        this.error(`ref \"${k}\" load failed`, r.reason);\r\n                        this.refs[k] = [];\r\n                    }\r\n                }\r\n                );\r\n\r\n                this.log('refs loaded', Object.keys(this.refs).map(k => `${k}(${(this.refs[k] || []).length})`).join(', '));\r\n                this._refsLoaded = true;\r\n                return this.refs;\r\n            } catch (err) {\r\n                this.error('fetchRefs error', err);\r\n                this.refs = {};\r\n                this._refsLoaded = true;\r\n                return {};\r\n            } finally {\r\n                this.hideLoading();\r\n                this._refsLoading = null;\r\n            }\r\n        }\r\n        )();\r\n\r\n        return this._refsLoading;\r\n    }\r\n\r\n    async _ensureRefLoaded(refKey) {\r\n        if (!refKey)\r\n            return [];\r\n        if (this.refs && Array.isArray(this.refs[refKey]) && this.refs[refKey].length)\r\n            return this.refs[refKey];\r\n        try {\r\n            const refProvider = (this.apis.refs || {})[refKey];\r\n            if (typeof refProvider === 'function') {\r\n                try {\r\n                    const res = await refProvider();\r\n                    this.refs[refKey] = this._normalizeListResponse(res);\r\n                    this.log(`ref \"${refKey}\" loaded via provider`, (this.refs[refKey] || []).length);\r\n                    return this.refs[refKey];\r\n                } catch (e) {\r\n                    this.error(`ref provider \"${refKey}\" error`, e);\r\n                }\r\n            }\r\n        } catch (e) {\r\n            this.error(`_ensureRefLoaded error for ${refKey}`, e);\r\n        }\r\n        await this.fetchRefs();\r\n        return this.refs[refKey] || [];\r\n    }\r\n\r\n    async _populateSelectFromRef(selectEl, field) {\r\n        if (!selectEl)\r\n            return;\r\n        try {\r\n            const placeholder = selectEl.querySelector('option[aria-placeholder=\"true\"]') || selectEl.querySelector('option:first-child');\r\n            Array.from(selectEl.querySelectorAll('option')).forEach(opt => {\r\n                if (opt === placeholder)\r\n                    return;\r\n                opt.remove();\r\n            }\r\n            );\r\n\r\n            let optsSource = field.options || null;\r\n            if (!optsSource && field.ref)\r\n                optsSource = await this._ensureRefLoaded(field.ref);\r\n\r\n            if (!optsSource || !optsSource.length) {\r\n                const tmp = document.createElement('option');\r\n                tmp.value = '';\r\n                tmp.disabled = true;\r\n                tmp.selected = true;\r\n                tmp.textContent = field.ref ? '\u041D\u0435\u0442 \u0434\u0430\u043D\u043D\u044B\u0445' : '\u041D\u0435\u0442 \u043E\u043F\u0446\u0438\u0439';\r\n                selectEl.appendChild(tmp);\r\n                return;\r\n            }\r\n\r\n            for (const o of optsSource) {\r\n                const {value, label} = this._mapOptionValueLabel(o, field);\r\n                const opt = document.createElement('option');\r\n                opt.value = value;\r\n                opt.textContent = label;\r\n                opt.title = label;\r\n                selectEl.appendChild(opt);\r\n            }\r\n\r\n            if (placeholder && placeholder.parentNode === selectEl)\r\n                selectEl.insertBefore(placeholder, selectEl.firstChild);\r\n        } catch (e) {\r\n            this.error('_populateSelectFromRef error', e);\r\n        }\r\n    }\r\n\r\n    _mapOptionValueLabel(opt, schemaField={}) {\r\n        if (typeof opt === 'string' || typeof opt === 'number')\r\n            return {\r\n                value: String(opt),\r\n                label: String(opt)\r\n            };\r\n        const valueKey = schemaField.valueKey || schemaField.valueProp || 'name';\r\n        const labelKey = schemaField.labelKey || schemaField.labelProp || 'fullname';\r\n        const candidates = [valueKey, 'value', 'id', 'name'];\r\n        const labelCandidates = [labelKey, 'name', 'fullname', 'label', 'title'];\r\n        let value;\r\n        for (const k of candidates)\r\n            if (opt[k] !== undefined && opt[k] !== null) {\r\n                value = opt[k];\r\n                break;\r\n            }\r\n        let label;\r\n        for (const k of labelCandidates)\r\n            if (opt[k] !== undefined && opt[k] !== null) {\r\n                label = opt[k];\r\n                break;\r\n            }\r\n        if (value === undefined)\r\n            value = (opt.value ?? opt.id ?? opt.name ?? JSON.stringify(opt));\r\n        if (label === undefined)\r\n            label = (opt.name ?? opt.fullname ?? opt.label ?? String(value));\r\n        return {\r\n            value: String(value),\r\n            label: String(label)\r\n        };\r\n    }\r\n\r\n    async openDeleteConfirm(id) {\r\n        const wrap = this._create('div');\r\n        wrap.innerHTML = `<p>\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u043B\u0435\u043C\u0435\u043D\u0442 <strong>${this.data.find(r => r.id == id).fullname}</strong>?</p>\r\n      <div style=\"display:flex;gap:8px;justify-content:flex-end;margin-top:12px\">\r\n        <button class=\"btn btn-danger btn-confirm\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\r\n        <button class=\"btn btn-secondary btn-cancel\" data-action=\"cancel\">\u041E\u0442\u043C\u0435\u043D\u0430</button>\r\n      </div>`;\r\n        const modal = this._ensureModalBuilder();\r\n        const m = modal.open('\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043D\u0438\u0435 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F', wrap);\r\n        const confirmBtn = wrap.querySelector('.btn-confirm');\r\n        const cancelBtn = wrap.querySelector('.btn-cancel');\r\n        return new Promise( (resolve) => {\r\n            cancelBtn.addEventListener('click', () => {\r\n                modal.close();\r\n                resolve(false);\r\n            }\r\n            );\r\n            confirmBtn.addEventListener('click', async () => {\r\n                try {\r\n                    if (!this.apis.apiDelete)\r\n                        throw new Error('apiDelete not provided');\r\n                    await this.apis.apiDelete(id);\r\n                    this.data = this.data.filter(d => String(d[this.idField]) !== String(id));\r\n                    this.applyFiltersAndRender();\r\n                    modal.close();\r\n                    this.log('Deleted', id);\r\n                    resolve(true);\r\n                } catch (err) {\r\n                    this.error('delete error', err);\r\n                    alert('\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438. \u0421\u043C\u043E\u0442\u0440\u0438\u0442\u0435 \u043A\u043E\u043D\u0441\u043E\u043B\u044C.');\r\n                    modal.close();\r\n                    resolve(false);\r\n                }\r\n            }\r\n            , {\r\n                once: true\r\n            });\r\n        }\r\n        );\r\n    }\r\n\r\n    async deleteRow(id) {\r\n        if (!confirm('\u0412\u044B \u0443\u0432\u0435\u0440\u0435\u043D\u044B, \u0447\u0442\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u043B\u0435\u043C\u0435\u043D\u0442?'))\r\n            return;\r\n        try {\r\n            const res = await this.apis.apiDelete(id);\r\n            const ok = (res === true) || (res && (res.success === true || res.ok === true || res.deleted === id));\r\n            if (!ok)\r\n                this.warn('delete returned ambiguous response', res);\r\n            this.data = this.data.filter(d => String(d[this.idField]) !== String(id));\r\n            this.applyFiltersAndRender();\r\n        } catch (err) {\r\n            this.error('deleteRow error', err);\r\n            alert('\u041E\u0448\u0438\u0431\u043A\u0430 \u043F\u0440\u0438 \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u0438. \u0421\u043C\u043E\u0442\u0440\u0438\u0442\u0435 \u043A\u043E\u043D\u0441\u043E\u043B\u044C.');\r\n        }\r\n    }\r\n\r\n    async init() {\r\n        this._ensureEls();\r\n        await this.fetchRefs();\r\n        const items = await this.fetchItems();\r\n        this.data = Array.isArray(items) ? items.map(it => ({\r\n            ...it\r\n        })) : [];\r\n        this.attachEvents();\r\n        this.applyFiltersAndRender();\r\n        this.log('initialized', this.meta());\r\n        return this;\r\n    }\r\n\r\n    async refresh() {\r\n        await this.fetchRefs();\r\n        const items = await this.fetchItems();\r\n        this.data = Array.isArray(items) ? items.map(it => ({\r\n            ...it\r\n        })) : [];\r\n        this.applyFiltersAndRender();\r\n        this.log('refreshed');\r\n    }\r\n\r\n    clearRefs() {\r\n        this.refs = {};\r\n        this._refsLoaded = false;\r\n        this._refsLoading = null;\r\n        this.log('refs cache cleared');\r\n    }\r\n\r\n    destroy() {\r\n        this.detachEvents();\r\n        if (this._modal)\r\n            this.modal._closeModal();\r\n        try {\r\n            if (this._els._customLoading)\r\n                this._els._customLoading.remove();\r\n        } catch (e) {}\r\n        try {\r\n            if (this._els._autoLoading)\r\n                this._els._autoLoading.remove();\r\n        } catch (e) {}\r\n        // cleanup price mask listeners (best-effort)\r\n        try {\r\n            document.querySelectorAll('input.bt-field-price').forEach(el => {\r\n                el.removeEventListener('input', this._livePriceInputHandler);\r\n                this._priceMaskCleanup(el);\r\n            }\r\n            );\r\n        } catch (e) {}\r\n        this._els = {};\r\n        this.data = [];\r\n        this.refs = {};\r\n        this.state = {\r\n            q: '',\r\n            sortBy: null,\r\n            sortDir: 1\r\n        };\r\n        this.log('destroyed');\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["control", "makeRow", "f", "cancelHandler", "li", "BaseTable", "e"]
}
